(function(b){function a(d,f,g){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},c=e[Modernizr.prefixed("transition")];d.each(function(i,j){function h(l){j.removeEventListener(c,h);g(j)}j.addEventListener(c,h)})}b.fn.addClassWithAnimationCallback=function(c,d){if(typeof Modernizr=="undefined"||!Modernizr.csstransitions){this.addClass(c);this.each(function(e,f){d(f)});return this}a(this,c,d);this.addClass(c);return this};b.fn.removeClassWithAnimationCallback=function(c,d){if(typeof Modernizr=="undefined"||!Modernizr.csstransitions){this.removeClass(c);this.each(function(e,f){d(f)});return this}a(this,c,d);this.removeClass(c);return this}})(jQuery);(function(b,a){var c=b(a);b.fn.lazyload=function(d){var f=this;var g;var e={threshold:0,failure_limit:0,event:"scroll",effect:"show",container:a,data_attribute:"original",skip_invisible:true,appear:null,load:null};function h(){var i=0;f.each(function(){var j=b(this);if(e.skip_invisible&&!j.is(":visible")){return}if(b.abovethetop(this,e)||b.leftofbegin(this,e)){}else{if(!b.belowthefold(this,e)&&!b.rightoffold(this,e)){j.trigger("lazyload:appear")}else{if(++i>e.failure_limit){return false}}}})}if(d){if(undefined!==d.failurelimit){d.failure_limit=d.failurelimit;delete d.failurelimit}if(undefined!==d.effectspeed){d.effect_speed=d.effectspeed;delete d.effectspeed}b.extend(e,d)}g=(e.container===undefined||e.container===a)?c:b(e.container);if(0===e.event.indexOf("scroll")){g.bind(e.event,function(i){return h()})}this.each(function(){var l=this;var p=b(l);l.loaded=false;l.error_event_set=false;var i=4000,o=4,m=0;var j=function(){if(!this.loaded){if(e.appear){var r=f.length;e.appear.call(l,r,e)}if(this.tagName==="IMG"){b("<img />").bind("load",function(){p.hide().attr("src",p.data(e.data_attribute))[e.effect](e.effect_speed);l.loaded=true;var s=b.grep(f,function(v){return !v.loaded});f=b(s);if(e.load){var u=f.length;e.load.call(l,u,e)}}).bind("error",function(){if(!l.error_event_set){a.setTimeout(b.proxy(n,this),i)}l.error_event_set=true}).attr("src",p.data(e.data_attribute))}else{p.css("background-image","url("+p.data(e.data_attribute)+")")[e.effect](e.effect_speed);l.loaded=true;var q=b.grep(f,function(s){return !s.loaded});f=b(q);if(e.load){var r=f.length;e.load.call(l,r,e)}}}};var n=function(){m+=1;if(m<=o){b(this).bind("error",function(){a.setTimeout(b.proxy(n,this),i)});var q=this.src.split("?")[0];this.src=q+"?"+new Date().getTime()}};p.one("lazyload:appear",j);if(0!==e.event.indexOf("scroll")){p.bind(e.event,function(q){if(!l.loaded){p.trigger("lazyload:appear")}})}});c.bind("resize",function(i){h()});h();return this};b.belowthefold=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.height()+c.scrollTop()}else{d=b(f.container).offset().top+b(f.container).height()}return d<=b(e).offset().top-f.threshold};b.rightoffold=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.width()+c.scrollLeft()}else{d=b(f.container).offset().left+b(f.container).width()}return d<=b(e).offset().left-f.threshold};b.abovethetop=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.scrollTop()}else{d=b(f.container).offset().top}return d>=b(e).offset().top+f.threshold+b(e).height()};b.leftofbegin=function(e,f){var d;if(f.container===undefined||f.container===a){d=c.scrollLeft()}else{d=b(f.container).offset().left}return d>=b(e).offset().left+f.threshold+b(e).width()};b.inviewport=function(d,e){return !b.rightofscreen(d,e)&&!b.leftofscreen(d,e)&&!b.belowthefold(d,e)&&!b.abovethetop(d,e)};b.extend(b.expr[":"],{"below-the-fold":function(d){return b.belowthefold(d,{threshold:0})},"above-the-top":function(d){return !b.belowthefold(d,{threshold:0})},"right-of-screen":function(d){return b.rightoffold(d,{threshold:0})},"left-of-screen":function(d){return !b.rightoffold(d,{threshold:0})},"in-viewport":function(d){return !b.inviewport(d,{threshold:0})},"above-the-fold":function(d){return !b.belowthefold(d,{threshold:0})},"right-of-fold":function(d){return b.rightoffold(d,{threshold:0})},"left-of-fold":function(d){return !b.rightoffold(d,{threshold:0})}})})(jQuery,window);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(d){var b={};d(document).ready(function(){Chorus.DynamicSizedImages.init()});var f=".vox-lazy-load";var a="lazy-loaded";var e="lazy-loading";function c(g,j){var h={failure_limit:20,load:function(){var p=d(this),n=p.parent(".image-window");if(p.is("img")){if(n.length>0){p.css({position:"absolute",top:Math.round((n.outerHeight()-p.outerHeight())/2),left:Math.round((n.outerWidth()-p.outerWidth())/2)});if(typeof p.attr("height")==="undefined"){p.css("height","auto")}}else{p.css("height","auto")}}p.addClass(a);p.removeClass(e);if(d.fn.playGIF){var o={};if(Chorus.Context&&Chorus.Context.main_link_color){o.circleBackgroundColor=Chorus.Context.main_link_color;o.circleTextColor="FFFFFF"}if(typeof PLAYGIF_DISABLE_FLAG==="undefined"){var m=d('.m-entry__body img[src*=".gif"], .m-block__fanshot-media img[src*=".gif"]');var q=d('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');if((m.length+q.length)===1){PLAYGIF_DISABLE_FLAG=true}else{PLAYGIF_DISABLE_FLAG=false;m.playGIF(o)}}p.playGIF(o)}},threshold:800};if(j){d.extend(h,j)}var g=g||d("body");var i=g.find(f+":visible").not("."+e,"."+a);var l=[];i.each(function(u,o){var q=d(this);var r=q.data("imgkey");if(typeof r!=="undefined"){var m=q.outerWidth();var v=q.outerHeight();if(q.is("img")){var p=q.data("ratio"),s=q.parent(".image-window");if(typeof p!=="undefined"&&p>0){v=Math.ceil(m/p)}if(s.length>0){m=Math.ceil(s.outerWidth());v=Math.ceil(s.outerHeight())}if(v>0){q.css("height",v)}}if(typeof window.devicePixelRatio!=="undefined"){m=Math.ceil(m*window.devicePixelRatio);v=Math.ceil(v*window.devicePixelRatio)}var n=r+":"+m+"x"+v;l.push(n);q.attr("data-dim",m+"x"+v);q.addClass(e)}else{q.lazyload(h)}});if(l.length==0){return}l.sort(function(n,m){return +n.split(":")[0]-+m.split(":")[0]});d.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",data:{imgkeys:l.join(",")},success:function(m){var n=m.urls;i.each(function(){var q=d(this);var p=q.data("imgkey")+":"+q.data("dim");var o=n[p];if(typeof o!=="undefined"){q.attr("data-original",o);q.lazyload(h)}})}})}b.init=function(){this.initUI();if(Chorus.EventDispatcher){Chorus.EventDispatcher.subscribe("moduleInserted",function(g){c(g.modules)})}};b.initUI=function(g,h){c(g,h)};b.applyTo=function(g,h){c(g,h)};return b}(jQuery);(function(E){function d(g){if(g&&void 0===g.allowPageScroll&&(void 0!==g.swipe||void 0!==g.swipeStatus)){g.allowPageScroll=l}g||(g={});g=E.extend({},E.fn.swipe.defaults,g);return this.each(function(){var m=E(this),n=m.data(j);n||(n=new a(this,g),m.data(j,n))})}function a(ag,ah){var ad,X,W,R;function C(F){var F=F.originalEvent,I,H=y?F.touches[0]:F;af=c;y?ac=F.touches.length:F.preventDefault();ab=0;aa=null;Z=0;!y||ac===ah.fingers||ah.fingers===i?(W=ad=H.pageX,R=X=H.pageY,z=(new Date).getTime(),ah.swipeStatus&&(I=Y(F,af))):Q(F);if(!1===I){return af=D,Y(F,af),I}ae.bind(B,A);ae.bind(x,w)}function A(F){F=F.originalEvent;if(!(af===s||af===D)){var K,I=y?F.touches[0]:F;ad=I.pageX;X=I.pageY;G=(new Date).getTime();aa=n();y&&(ac=F.touches.length);af=h;var I=F,H=aa;if(ah.allowPageScroll===l){I.preventDefault()}else{var J=ah.allowPageScroll===b;switch(H){case o:(ah.swipeLeft&&J||!J&&ah.allowPageScroll!=f)&&I.preventDefault();break;case u:(ah.swipeRight&&J||!J&&ah.allowPageScroll!=f)&&I.preventDefault();break;case r:(ah.swipeUp&&J||!J&&ah.allowPageScroll!=e)&&I.preventDefault();break;case p:(ah.swipeDown&&J||!J&&ah.allowPageScroll!=e)&&I.preventDefault()}}ac===ah.fingers||ah.fingers===i||!y?(ab=m(),Z=G-z,ah.swipeStatus&&(K=Y(F,af,aa,ab,Z)),ah.triggerOnTouchEnd||(I=!(ah.maxTimeThreshold?!(Z>=ah.maxTimeThreshold):1),!0===T()?(af=s,K=Y(F,af)):I&&(af=D,Y(F,af)))):(af=D,Y(F,af));!1===K&&(af=D,Y(F,af))}}function w(F){F=F.originalEvent;F.preventDefault();G=(new Date).getTime();ab=m();aa=n();Z=G-z;if(ah.triggerOnTouchEnd||!1===ah.triggerOnTouchEnd&&af===h){if(af=s,(ac===ah.fingers||ah.fingers===i||!y)&&0!==ad){var H=!(ah.maxTimeThreshold?!(Z>=ah.maxTimeThreshold):1);if((!0===T()||null===T())&&!H){Y(F,af)}else{if(H||!1===T()){af=D,Y(F,af)}}}else{af=D,Y(F,af)}}else{af===h&&(af=D,Y(F,af))}ae.unbind(B,A,!1);ae.unbind(x,w,!1)}function Q(){z=G=X=ad=R=W=ac=0}function Y(F,I){var H=void 0;ah.swipeStatus&&(H=ah.swipeStatus.call(ae,F,I,aa||null,ab||0,Z||0,ac));if(I===D&&ah.click&&(1===ac||!y)&&(isNaN(ab)||0===ab)){H=ah.click.call(ae,F,F.target)}if(I==s){switch(ah.swipe&&(H=ah.swipe.call(ae,F,aa,ab,Z,ac)),aa){case o:ah.swipeLeft&&(H=ah.swipeLeft.call(ae,F,aa,ab,Z,ac));break;case u:ah.swipeRight&&(H=ah.swipeRight.call(ae,F,aa,ab,Z,ac));break;case r:ah.swipeUp&&(H=ah.swipeUp.call(ae,F,aa,ab,Z,ac));break;case p:ah.swipeDown&&(H=ah.swipeDown.call(ae,F,aa,ab,Z,ac))}}(I===D||I===s)&&Q(F);return H}function T(){return null!==ah.threshold?ab>=ah.threshold:null}function m(){return Math.round(Math.sqrt(Math.pow(ad-W,2)+Math.pow(X-R,2)))}function n(){var F;F=Math.atan2(X-R,W-ad);F=Math.round(180*F/Math.PI);0>F&&(F=360-Math.abs(F));return 45>=F&&0<=F?o:360>=F&&315<=F?o:135<=F&&225>=F?u:45<F&&135>F?p:r}function g(){ae.unbind(N,C);ae.unbind(M,Q);ae.unbind(B,A);ae.unbind(x,w)}var v=y||!ah.fallbackToMouseEvents,N=v?"touchstart":"mousedown",B=v?"touchmove":"mousemove",x=v?"touchend":"mouseup",M="touchcancel",ab=0,aa=null,Z=0,ae=E(ag),af="start",ac=0,z=X=ad=R=W=0,G=0;try{ae.bind(N,C),ae.bind(M,Q)}catch(q){E.error("events not supported "+N+","+M+" on jQuery.swipe")}this.enable=function(){ae.bind(N,C);ae.bind(M,Q);return ae};this.disable=function(){g();return ae};this.destroy=function(){g();ae.data(j,null);return ae}}var o="left",u="right",r="up",p="down",l="none",b="auto",f="horizontal",e="vertical",i="all",c="start",h="move",s="end",D="cancel",y="ontouchstart" in window,j="TouchSwipe";E.fn.swipe=function(n){var g=E(this),m=g.data(j);if(m&&"string"===typeof n){if(m[n]){return m[n].apply(this,Array.prototype.slice.call(arguments,1))}E.error("Method "+n+" does not exist on jQuery.swipe")}else{if(!m&&("object"===typeof n||!n)){return d.apply(this,arguments)}}return g};E.fn.swipe.defaults={fingers:1,threshold:75,maxTimeThreshold:null,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,click:null,triggerOnTouchEnd:!0,allowPageScroll:"auto",fallbackToMouseEvents:!0};E.fn.swipe.phases={PHASE_START:c,PHASE_MOVE:h,PHASE_END:s,PHASE_CANCEL:D};E.fn.swipe.directions={LEFT:o,RIGHT:u,UP:r,DOWN:p};E.fn.swipe.pageScroll={NONE:l,HORIZONTAL:f,VERTICAL:e,AUTO:b};E.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:i}})(jQuery);(function(d){function c(j){j.preventDefault();var i=j.data;var l=i.attr("href");var f=i.data("rec-url")===l;var h=i.data("recommend-entry-id");var g=d('*[data-recommend-entry-id="'+h+'"]');d.post(l,function(){g.each(function(){b(f,d(this))})})}function a(f){var e=f.data("rec-count");f.find(".recommend-link-count").remove();if(e<1){e=""}f.append('<span class="recommend-link-count p-button__count">'+e+"</span>")}function b(f,g){var e=parseInt(g.data("rec-count"));if(f){g.attr("href",g.data("unrec-url"));g.data("rec-count",e+1);g.find(".p-button__social-text").text("Unrec");g.find(".p-button__social-text-long").text("Unrecommend this Post");a(g)}else{g.attr("href",g.data("rec-url"));g.data("rec-count",e-1);g.find(".p-button__social-text").text("Rec");g.find(".p-button__social-text-long").text("Recommend this Post");a(g)}}d.fn.sbnRecommendLink=function(){return this.each(function(){var e=d(this);if(e.data("rec-link-init")===true){return}e.data("rec-link-init",true);e.on("click",e,c);a(e)})}})(jQuery);(function(a){a("*[data-recommend-entry-id]").sbnRecommendLink()})(jQuery);(function(a){a.fn.serializeObject=function(){var b=this,d={},c={},e={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};this.build=function(h,f,g){h[f]=g;return h};this.push_counter=function(f){if(c[f]===undefined){c[f]=0}return c[f]++};a.each(a(this).serializeArray(),function(){if(!e.validate.test(this.name)){return}var f,g=this.name.match(e.key),i=this.value,h=this.name;while((f=g.pop())!==undefined){h=h.replace(new RegExp("\\["+f+"\\]$"),"");if(f.match(e.push)){i=b.build([],b.push_counter(h),i)}else{if(f.match(e.fixed)){i=b.build([],f,i)}else{if(f.match(e.named)){i=b.build({},f,i)}}}}d=a.extend(true,d,i)});return d}})(jQuery);(function(b){function a(f,d){var e={oddClass:d.oddClass||"ui-state-odd",evenClass:d.evenClass||"ui-state-even",highlightRows:(d.highlightRows===true)?true:false,highlightClass:d.highlighClass||"ui-state-hover"};var c=f.find("tbody tr");if(e.highlightRows){c.unbind("mouseenter",function(){b(this).addClass(e.highlighClass)});c.unbind("mouseleave",function(){b(this).removeClass(e.highlighClass)});c.bind("mouseenter",function(){b(this).addClass(e.highlighClass)});c.bind("mouseleave",function(){b(this).removeClass(e.highlighClass)})}if(e.oddClass){c.filter(":odd").addClass(e.oddClass)}if(e.evenClass){c.filter(":even").addClass(e.evenClass)}}b.fn.zebraTables=function(c){if(this.length>0){var d=c||{};table=this;a(table,d);this.bind("DOMNodeInserted",function(){a(table,d)})}return this}})(jQuery);
/*!
 * Play GIF
 * 
 * by Jesse Young
 *
 * a jQuery plugin to play GIF animations on mouseover (or any other event).
 * 
 * Examples:
 *    $('img[src$=".gif"]').playGIF();             // default is mouseover
 *    $('img[src$=".gif"]').playGIF({on:'click'}); // play animation on click
 */
;var PLAYGIF_DISABLE_FLAG;(function(a){a.fn.playGIF=function(c){var d=a.extend({on:"mouseenter",off:"mouseleave",autoResize:false,enable:true,circleBackgroundColor:"FFF200",circleTextColor:"4C4E4D",removeAnchor:true},c);if(typeof PLAYGIF_DISABLE_FLAG!=="undefined"){d.enable=!PLAYGIF_DISABLE_FLAG}var b=function(g,f,h){f=Math.floor(f);h=Math.floor(h);var e=35;g.fillStyle="#"+d.circleBackgroundColor;g.beginPath();g.arc(f,h,e,0,Math.PI*2,true);g.closePath();g.fill();g.fillStyle="#"+d.circleTextColor;g.font="15px 'Gotham SSm A', 'Gotham SSm B', sans-serif";g.textAlign="center";g.textBaseline="middle";g.fillText("GIF",f,h)};return this.each(function(){if(d.enable===false){return}var j=a(this);if(!j.is("img")||!/\.gif$/i.test(j.attr("src"))){return true}var h=document.createElement("canvas");if(typeof h.getContext==="undefined"){return true}var i=h.getContext("2d");var g=new Image();var f=function(m,l){l.on(d.off,function(){e(m,l)});var n=l.attr("src");l.attr("src","data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==");l.css({width:m.attr("width"),height:m.attr("height")});setTimeout(function(){l.attr("src",n)},0);m.replaceWith(l)};var e=function(m,l){m.on(d.on,function(){f(m,l)});l.replaceWith(m)};g.onload=function(){var m=j.width();var l=j.height();h.width=m;h.height=l;i.drawImage(g,0,0,m,l);var n=a(h);if(d.autoResize===true){h.setAttribute("data-src",j.attr("src"));h.setAttribute("class","gif");var p=a('<span class="faux-image">');p.css({"float":j.css("float"),margin:j.css("margin"),padding:j.css("padding"),"max-width":"100%",position:"relative",display:"block",height:h.height});n.css({position:"absolute",top:0,left:0});n=p.append(n)}else{n.css({"float":j.css("float"),margin:j.css("margin"),padding:j.css("padding"),display:j.css("display")})}j.replaceWith(n);var o=n.parent();if(!o.is("p")&&(o.css("max-width")!=="none"||o.css("max-height")!=="none")){m=o.width();l=o.height()}if(d.removeAnchor){if(o.is("a")&&/\.gif$/i.test(o.attr("href"))){o.replaceWith(n)}}if(m>150&&l>150){b(i,m/2,l/2)}n.on(d.on,function(){f(n,j)})};g.src=j.attr("src")})}})(jQuery);(function(a){a.fn.redraw=function(){return a(this).each(function(){var b=document.createTextNode(" ");a(this).append(b);setTimeout(function(){b.parentNode.removeChild(b)},0)})}})(jQuery);(function(a){a.fn.noUiSlider=function(l,g){var h=window.navigator.msPointerEnabled?2:"ontouchend" in document?3:1;if(window.debug&&console){console.log(h)}function j(o,n,m){if(typeof o==="function"){o.call(n,m)}}var i={to:function(m,n){n=m[0]<0?n+Math.abs(m[0]):n-m[0];return(n*100)/this._length(m)},from:function(m,n){return(n*100)/this._length(m)},is:function(m,n){return((n*this._length(m))/100)+m[0]},_length:function(m){return(m[0]>m[1]?m[0]-m[1]:m[1]-m[0])}};function f(s,m,q){var p=m.data("setup"),v=p.handles,o=p.settings,u=p.pos;s=s<0?0:s>100?100:s;if(o.handles==2){if(q.is(":first-child")){var r=parseFloat(v[1][0].style[u])-o.margin;s=s>r?r:s}else{var r=parseFloat(v[0][0].style[u])+o.margin;s=s<r?r:s}}if(o.step){var n=i.from(o.range,o.step);s=Math.round(s/n)*n}return s}function b(m){try{return[(m.clientX||m.originalEvent.clientX||m.originalEvent.touches[0].clientX),(m.clientY||m.originalEvent.clientY||m.originalEvent.touches[0].clientY)]}catch(n){return["x","y"]}}function e(m,n){return parseFloat(m[0].style[n])}var d={handles:2,serialization:{to:["",""],resolution:0.01}};methods={create:function(){return this.each(function(){function u(G,H,F){G.css(p,H+"%").data("input").val(i.is(A.range,H).toFixed(D))}var A=a.extend(d,l),x="<a><div></div></a>",w=a(this).data("_isnS_",true),m=[],p,o,B="",r=function(F){return !isNaN(parseFloat(F))&&isFinite(F)},v=(A.serialization.resolution=A.serialization.resolution||0.01).toString().split("."),D=v[0]==1?0:v[1].length;A.start=r(A.start)?[A.start,0]:A.start;a.each(A,function(G,F){if(r(F)){A[G]=parseFloat(F)}else{if(typeof F=="object"&&r(F[0])){F[0]=parseFloat(F[0]);if(r(F[1])){F[1]=parseFloat(F[1])}}}var H=false;F=typeof F=="undefined"?"x":F;switch(G){case"range":case"start":H=F.length!=2||!r(F[0])||!r(F[1]);break;case"handles":H=(F<1||F>2||!r(F));break;case"connect":H=F!="lower"&&F!="upper"&&typeof F!="boolean";break;case"orientation":H=(F!="vertical"&&F!="horizontal");break;case"margin":case"step":H=typeof F!="undefined"&&!r(F);break;case"serialization":H=typeof F!="object"||!r(F.resolution)||(typeof F.to=="object"&&F.to.length<A.handles);break;case"slide":H=typeof F!="function";break}if(H&&console){console.error("Bad input for "+G+" on slider:",w)}});A.margin=A.margin?i.from(A.range,A.margin):0;if(A.serialization.to instanceof jQuery||typeof A.serialization.to=="string"||A.serialization.to===false){A.serialization.to=[A.serialization.to]}if(A.orientation=="vertical"){B+="vertical";p="top";o=1}else{B+="horizontal";p="left";o=0}B+=A.connect?A.connect=="lower"?" connect lower":" connect":"";w.addClass(B);for(var y=0;y<A.handles;y++){m[y]=w.append(x).children(":last");var s=i.to(A.range,A.start[y]);m[y].css(p,s+"%");if(s==100&&m[y].is(":first-child")){m[y].css("z-index",2)}var E=".noUiSlider",q=(h===1?"mousedown":h===2?"MSPointerDown":"touchstart")+E+"X",n=(h===1?"mousemove":h===2?"MSPointerMove":"touchmove")+E,z=(h===1?"mouseup":h===2?"MSPointerUp":"touchend")+E;m[y].find("div").on(q,function(L){a("body").bind("selectstart"+E,function(){return false});if(!w.hasClass("disabled")){a("body").addClass("TOUCH");var K=a(this).addClass("active").parent(),J=K.add(a(document)).add("body"),I=parseFloat(K[0].style[p]),G=b(L),F=G,H=false;a(document).on(n,function(P){P.preventDefault();var O=b(P);if(O[0]=="x"){return}O[0]-=G[0];O[1]-=G[1];var M=[F[0]!=O[0],F[1]!=O[1]],N=I+((O[o]*100)/(o?w.height():w.width()));N=f(N,w,K);if(M[o]&&N!=H){K.css(p,N+"%").data("input").val(i.is(A.range,N).toFixed(D));j(A.slide,w.data("_n",true));H=N;K.css("z-index",m.length==2&&N==100&&K.is(":first-child")?2:1)}F=O}).on(z,function(){J.off(E);a("body").removeClass("TOUCH");if(w.find(".active").removeClass("active").end().data("_n")){w.data("_n",false).change()}})}}).on("click",function(F){F.stopPropagation()})}if(h==1){w.on("click",function(I){if(!w.hasClass("disabled")){var G=b(I),F=((G[o]-w.offset()[p])*100)/(o?w.height():w.width()),H=m.length>1?(G[o]<(m[0].offset()[p]+m[1].offset()[p])/2?m[0]:m[1]):m[0];u(H,f(F,w,H),w);j(A.slide,w);w.change()}})}for(var y=0;y<m.length;y++){var C=i.is(A.range,e(m[y],p)).toFixed(D);if(typeof A.serialization.to[y]=="string"){m[y].data("input",w.append('<input type="hidden" name="'+A.serialization.to[y]+'">').find("input:last").val(C).change(function(F){F.stopPropagation()}))}else{if(A.serialization.to[y]==false){m[y].data("input",{val:function(F){if(typeof F!="undefined"){this.handle.data("noUiVal",F)}else{return this.handle.data("noUiVal")}},handle:m[y]})}else{m[y].data("input",A.serialization.to[y].data("handleNR",y).val(C).change(function(){var F=[null,null];F[a(this).data("handleNR")]=a(this).val();w.val(F)}))}}}a(this).data("setup",{settings:A,handles:m,pos:p,res:D})})},val:function(){if(typeof arguments[0]!=="undefined"){var p=typeof arguments[0]=="number"?[arguments[0]]:arguments[0];return this.each(function(){var q=a(this).data("setup");for(var s=0;s<q.handles.length;s++){if(p[s]!=null){var r=f(i.to(q.settings.range,p[s]),a(this),q.handles[s]);q.handles[s].css(q.pos,r+"%").data("input").val(i.is(q.settings.range,r).toFixed(q.res))}}})}else{var n=a(this).data("setup").handles,o=[];for(var m=0;m<n.length;m++){o.push(parseFloat(n[m].data("input").val()))}return o.length==1?o[0]:o}},disabled:function(){return g?a(this).addClass("disabled"):a(this).removeClass("disabled")}};var c=jQuery.fn.val;jQuery.fn.val=function(){return this.data("_isnS_")?methods.val.apply(this,arguments):c.apply(this,arguments)};return l=="disabled"?methods.disabled.apply(this):methods.create.apply(this)}})(jQuery);(function(a){a.address=function(){var aI=function(d){d=a.extend(a.Event(d),function(){for(var g={},h=a.address.parameterNames(),e=0,i=h.length;e<i;e++){g[h[e]]=a.address.parameter(h[e])}return{value:a.address.value(),path:a.address.path(),pathNames:a.address.pathNames(),parameterNames:h,parameters:g,queryString:a.address.queryString()}}.call(a.address));a(a.address).trigger(d);return d},aH=function(d){return Array.prototype.slice.call(d)},aQ=function(){a().bind.apply(a(a.address),Array.prototype.slice.call(arguments));return a.address},b=function(){a().unbind.apply(a(a.address),Array.prototype.slice.call(arguments));return a.address},an=function(){return aA.pushState&&aT.state!==aR},S=function(){return("/"+aP.pathname.replace(new RegExp(aT.state),"")+aP.search+(ag()?"#"+ag():"")).replace(ab,"/")},ag=function(){var d=aP.href.indexOf("#");return d!=-1?aG(aP.href.substr(d+1),aN):""},aF=function(){return an()?S():ag()},R=function(){return"javascript"},ad=function(d){d=d.toString();return(aT.strict&&d.substr(0,1)!="/"?"/":"")+d},aG=function(e,d){if(aT.crawlable&&d){return(e!==""?"!":"")+e}return e.replace(/^\!/,"")},aE=function(e,d){return parseInt(e.css(d),10)},ak=function(){if(!aC){var d=aF();if(decodeURI(aS)!=decodeURI(d)){if(aD&&ar<7){aP.reload()}else{aD&&!am&&aT.history&&aJ(af,50);_old=aS;aS=d;al(aN)}}}},al=function(e){var d=aI(Q);e=aI(e?y:p);aJ(az,10);if(d.isDefaultPrevented()||e.isDefaultPrevented()){av()}},av=function(){aS=_old;if(an()){aA.popState({},"",aT.state.replace(/\/$/,"")+(aS===""?"/":aS))}else{aC=aL;if(aq){if(aT.history){aP.hash="#"+aG(aS,aL)}else{aP.replace("#"+aG(aS,aL))}}else{if(aS!=aF()){if(aT.history){aP.hash="#"+aG(aS,aL)}else{aP.replace("#"+aG(aS,aL))}}}aD&&!am&&aT.history&&aJ(af,50);if(aq){aJ(function(){aC=aN},1)}else{aC=aN}}},az=function(){if(aT.tracker!=="null"&&aT.tracker!==aj){var e=a.isFunction(aT.tracker)?aT.tracker:aO[aT.tracker],d=(aP.pathname+aP.search+(a.address&&!an()?a.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");if(a.isFunction(e)){e(d)}else{if(a.isFunction(aO.urchinTracker)){aO.urchinTracker(d)}else{if(aO.pageTracker!==aR&&a.isFunction(aO.pageTracker._trackPageview)){aO.pageTracker._trackPageview(d)}else{aO._gaq!==aR&&a.isFunction(aO._gaq.push)&&aO._gaq.push(["_trackPageview",decodeURI(d)])}}}}},af=function(){var d=R()+":"+aN+";document.open();document.writeln('<html><head><title>"+aK.title.replace(/\'/g,"\\'")+"</title><script>var "+ap+' = "'+encodeURIComponent(aF()).replace(/\'/g,"\\'")+(aK.domain!=aP.hostname?'";document.domain="'+aK.domain:"")+"\";<\/script></head></html>');document.close();";if(ar<7){aM.src=d}else{aM.contentWindow.location.replace(d)}},ax=function(){if(ai&&f!=-1){var e,d,g=ai.substr(f+1).split("&");for(e=0;e<g.length;e++){d=g[e].split("=");if(/^(autoUpdate|crawlable|history|strict|wrap)$/.test(d[0])){aT[d[0]]=isNaN(d[1])?/^(true|yes)$/i.test(d[1]):parseInt(d[1],10)!==0}if(/^(state|tracker)$/.test(d[0])){aT[d[0]]=d[1]}}ai=aj}_old=aS;aS=aF()},aU=function(){if(!at){at=aL;ax();var e=function(){c.call(this);aB.call(this)},d=a("body").ajaxComplete(e);e();if(aT.wrap){a("body > *").wrapAll('<div style="padding:'+(aE(d,"marginTop")+aE(d,"paddingTop"))+"px "+(aE(d,"marginRight")+aE(d,"paddingRight"))+"px "+(aE(d,"marginBottom")+aE(d,"paddingBottom"))+"px "+(aE(d,"marginLeft")+aE(d,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+ap+'" style="height:100%;overflow:auto;position:relative;'+(aq&&!window.statusbar.visible?"resize:both;":"")+'" />');a("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});aq&&a('<style type="text/css" />').appendTo("head").text("#"+ap+"::-webkit-resizer { background-color: #fff; }")}if(aD&&!am){e=aK.getElementsByTagName("frameset")[0];aM=aK.createElement((e?"":"i")+"frame");aM.src=R()+":"+aN;if(e){e.insertAdjacentElement("beforeEnd",aM);e[e.cols?"cols":"rows"]+=",0";aM.noResize=aL;aM.frameBorder=aM.frameSpacing=0}else{aM.style.display="none";aM.style.width=aM.style.height=0;aM.tabIndex=-1;aK.body.insertAdjacentElement("afterBegin",aM)}aJ(function(){a(aM).bind("load",function(){var g=aM.contentWindow;_old=aS;aS=g[ap]!==aR?g[ap]:"";if(aS!=aF()){al(aN);aP.hash=aG(aS,aL)}});aM.contentWindow[ap]===aR&&af()},50)}aJ(function(){aI("init");al(aN)},1);if(!an()){if(aD&&ar>7||!aD&&am){if(aO.addEventListener){aO.addEventListener(ah,ak,aN)}else{aO.attachEvent&&aO.attachEvent("on"+ah,ak)}}else{aw(ak,50)}}"state" in window.history&&a(window).trigger("popstate")}},c=function(){var g,e=a("a"),h=e.size(),d=-1,i=function(){if(++d!=h){g=a(e.get(d));g.is('[rel*="address:"]')&&g.address('[rel*="address:"]');aJ(i,1)}};aJ(i,1)},aB=function(){if(aT.crawlable){var d=aP.pathname.replace(/\/$/,"");a("body").html().indexOf("_escaped_fragment_")!=-1&&a('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var e=a(this).attr("href").replace(/^http:/,"").replace(new RegExp(d+"/?$"),"");if(e===""||e.indexOf("_escaped_fragment_")!=-1){a(this).attr("href","#"+encodeURI(decodeURIComponent(e.replace(/\/(.*)\?_escaped_fragment_=(.*)$/,"!$2"))))}})}},aR,aj=null,ap="jQueryAddress",ah="hashchange",Q="change",y="internalChange",p="externalChange",aL=true,aN=false,aT={autoUpdate:aL,crawlable:aN,history:aL,strict:aL,wrap:aN},ao=a.browser,ar=parseFloat(ao.version),aD=!a.support.opacity,aq=ao.webkit||ao.safari,aO=function(){try{return top.document!==aR&&top.document.title!==aR?top:window}catch(d){return window}}(),aK=aO.document,aA=aO.history,aP=aO.location,aw=setInterval,aJ=setTimeout,ab=/\/{2,9}/g;ao=navigator.userAgent;var am="on"+ah in aO,aM,ai=a("script:last").attr("src"),f=ai?ai.indexOf("?"):-1,ac=aK.title,aC=aN,at=aN,ay=aL,ae=aN,aS=aF();_old=aS;if(aD){ar=parseFloat(ao.substr(ao.indexOf("MSIE")+4));if(aK.documentMode&&aK.documentMode!=ar){ar=aK.documentMode!=8?7:8}var au=aK.onpropertychange;aK.onpropertychange=function(){au&&au.call(aK);if(aK.title!=ac&&aK.title.indexOf("#"+aF())!=-1){aK.title=ac}}}if(aA.navigationMode){aA.navigationMode="compatible"}if(document.readyState=="complete"){var m=setInterval(function(){if(a.address){aU();clearInterval(m)}},50)}else{ax();a(aU)}a(window).bind("popstate",function(){if(decodeURI(aS)!=decodeURI(aF())){_old=aS;aS=aF();al(aN)}}).bind("unload",function(){if(aO.removeEventListener){aO.removeEventListener(ah,ak,aN)}else{aO.detachEvent&&aO.detachEvent("on"+ah,ak)}});return{bind:function(){return aQ.apply(this,aH(arguments))},unbind:function(){return b.apply(this,aH(arguments))},init:function(){return aQ.apply(this,["init"].concat(aH(arguments)))},change:function(){return aQ.apply(this,[Q].concat(aH(arguments)))},internalChange:function(){return aQ.apply(this,[y].concat(aH(arguments)))},externalChange:function(){return aQ.apply(this,[p].concat(aH(arguments)))},baseURL:function(){var d=aP.href;if(d.indexOf("#")!=-1){d=d.substr(0,d.indexOf("#"))}if(/\/$/.test(d)){d=d.substr(0,d.length-1)}return d},autoUpdate:function(d){if(d!==aR){aT.autoUpdate=d;return this}return aT.autoUpdate},crawlable:function(d){if(d!==aR){aT.crawlable=d;return this}return aT.crawlable},history:function(d){if(d!==aR){aT.history=d;return this}return aT.history},state:function(e){if(e!==aR){aT.state=e;var d=S();if(aT.state!==aR){if(aA.pushState){d.substr(0,3)=="/#/"&&aP.replace(aT.state.replace(/^\/$/,"")+d.substr(2))}else{d!="/"&&d.replace(/^\/#/,"")!=ag()&&aJ(function(){aP.replace(aT.state.replace(/^\/$/,"")+"/#"+d)},1)}}return this}return aT.state},strict:function(d){if(d!==aR){aT.strict=d;return this}return aT.strict},tracker:function(d){if(d!==aR){aT.tracker=d;return this}return aT.tracker},wrap:function(d){if(d!==aR){aT.wrap=d;return this}return aT.wrap},update:function(){ae=aL;this.value(aS);ae=aN;return this},title:function(d){if(d!==aR){aJ(function(){ac=aK.title=d;if(ay&&aM&&aM.contentWindow&&aM.contentWindow.document){aM.contentWindow.document.title=d;ay=aN}},50);return this}return aK.title},value:function(d){if(d!==aR){d=ad(d);if(d=="/"){d=""}if(aS==d&&!ae){return}_old=aS;aS=d;if(aT.autoUpdate||ae){al(aL);if(an()){aA[aT.history?"pushState":"replaceState"]({},"",aT.state.replace(/\/$/,"")+(aS===""?"/":aS))}else{aC=aL;if(aq){if(aT.history){aP.hash="#"+aG(aS,aL)}else{aP.replace("#"+aG(aS,aL))}}else{if(aS!=aF()){if(aT.history){aP.hash="#"+aG(aS,aL)}else{aP.replace("#"+aG(aS,aL))}}}aD&&!am&&aT.history&&aJ(af,50);if(aq){aJ(function(){aC=aN},1)}else{aC=aN}}}return this}return ad(aS)},path:function(e){if(e!==aR){var d=this.queryString(),g=this.hash();this.value(e+(d?"?"+d:"")+(g?"#"+g:""));return this}return ad(aS).split("#")[0].split("?")[0]},pathNames:function(){var e=this.path(),d=e.replace(ab,"/").split("/");if(e.substr(0,1)=="/"||e.length===0){d.splice(0,1)}e.substr(e.length-1,1)=="/"&&d.splice(d.length-1,1);return d},queryString:function(e){if(e!==aR){var d=this.hash();this.value(this.path()+(e?"?"+e:"")+(d?"#"+d:""));return this}e=aS.split("?");return e.slice(1,e.length).join("?").split("#")[0]},parameter:function(o,n,j){var e,d;if(n!==aR){var i=this.parameterNames();d=[];n=n===aR||n===aj?"":n.toString();for(e=0;e<i.length;e++){var h=i[e],l=this.parameter(h);if(typeof l=="string"){l=[l]}if(h==o){l=n===aj||n===""?[]:j?l.concat([n]):[n]}for(var g=0;g<l.length;g++){d.push(h+"="+l[g])}}a.inArray(o,i)==-1&&n!==aj&&n!==""&&d.push(o+"="+n);this.queryString(d.join("&"));return this}if(n=this.queryString()){j=[];d=n.split("&");for(e=0;e<d.length;e++){n=d[e].split("=");n[0]==o&&j.push(n.slice(1).join("="))}if(j.length!==0){return j.length!=1?j:j[0]}}},parameterNames:function(){var g=this.queryString(),e=[];if(g&&g.indexOf("=")!=-1){g=g.split("&");for(var h=0;h<g.length;h++){var d=g[h].split("=")[0];a.inArray(d,e)==-1&&e.push(d)}}return e},hash:function(d){if(d!==aR){this.value(aS.split("#")[0]+(d?"#"+d:""));return this}d=aS.split("#");return d.slice(1,d.length).join("#")}}}();a.fn.address=function(c){var b;if(typeof c=="string"){b=c;c=undefined}a(this).attr("address")||a(b?b:this).live("click",function(d){if(d.shiftKey||d.ctrlKey||d.metaKey||d.which==2){return true}if(a(this).is("a")){d.preventDefault();d=c?c.call(this):/address:/.test(a(this).attr("rel"))?a(this).attr("rel").split("address:")[1].split(" ")[0]:a.address.state()!==undefined&&!/^\/?$/.test(a.address.state())?a(this).attr("href").replace(new RegExp("^(.*"+a.address.state()+"|\\.)"),""):a(this).attr("href").replace(/^(#\!?|\.)/,"");a.address.value(d)}}).live("submit",function(d){if(a(this).is("form")){d.preventDefault();d=a(this).attr("action");d=c?c.call(this):(d.indexOf("?")!=-1?d.replace(/&$/,""):d+"?")+a(this).serialize();a.address.value(d)}}).attr("address",true);return this}})(jQuery);jQuery(document).ready(function(b){var a={networkVars:{sbn:{scope:b(".m-entry__body"),linkable:"p",buffer:false},verge:{scope:b(".article-body, .entry-content"),linkable:"p",buffer:b("#network-bar")},polygon:{scope:b("article .body, .forum_article"),linkable:"p",buffer:b("#polybar")}},init:function(){this.config(function(){if(a.scope.length){b(document).bind("keydown",a.keydown);a.buildLinks(a.readHash)}})},config:function(c){this.network=window.Chorus.Context.network_slug;this.scope=this.networkVars[this.network].scope;this.linkable=this.scope.find(this.networkVars[this.network].linkable).filter(function(){if(b(this).parents("table").length==0){return b(this)}});this.keyStore=this.keyDivider="|";this.trigger="|16|16|";this.linksVisible=false;this.linkClassname="pgh-link";this.scrollSpeed=200;this.highlightFadeSpeed=5000;this.extraBuffer=100;this.loaded=false;this.paragraphClassname="pgh-paragraph";this.buffer=(this.networkVars[this.network].buffer)?this.networkVars[this.network].buffer.outerHeight():0;c()},buildLinks:function(c){a.linkable.each(function(d,e){var g=b(e);if(g.text().replace(/^\s+|\s+$/g,"")!==""){var h=g.offset();var f=b('<a href="" id="pgh'+d+'" class="'+a.linkClassname+'" />').css({top:h.top,left:h.left}).data({id:d,top:Math.floor(h.top)});g.attr("id","paragraph"+d).addClass(a.paragraphClassname).data("id",d);b("body").append(f)}});a.links=b("."+a.linkClassname);a.links.on("click",a.buildHash);c()},recalculateLinks:function(){b("."+a.paragraphClassname).each(function(c,d){var f=b(d);var g=f.offset();var e=b("#pgh"+f.data("id"));e.css("top",g.top).data("top",g.top)})},buildHash:function(){var c=b(this).data();window.location.hash="pgh/"+c.id+"/"+c.top;a.scrollToParagraph(c.id,c.top,false);return false},readHash:function(){if(window.location.hash&&window.location.hash.indexOf("pgh")>-1){var c=window.location.hash.split("/");a.scrollToParagraph(c[1],c[2],true)}},scrollToParagraph:function(h,f,d){var c=f-this.buffer;var g=b("#paragraph"+h);if(d){var e=this.scope.find(this.networkVars[this.network].linkable);c-=this.extraBuffer;e.fadeTo(0,0.25,function(){g.fadeTo(0,1)});setTimeout(function(){e.fadeTo(500,1)},this.highlightFadeSpeed)}b("html, body").animate({scrollTop:c},this.scrollSpeed)},keydown:function(d){var c=d.keyCode;a.keyStore=a.keyStore+c+a.keyDivider;if(a.keyStore.indexOf(a.trigger)>-1){if(a.linksVisible){a.linksVisible=false;a.links.hide()}else{if(!a.loaded){a.recalculateLinks();a.loaded=true}a.linksVisible=true;a.links.show()}}setTimeout(function(){a.keyStore=a.keyDivider},500)}};a.init()});(function(b,d){if(b.rails!==d){b.error("jquery-ujs has already been loaded!")}var a;var c=b(document);b.rails=a={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",buttonClickSelector:"button[data-remote], button[data-confirm]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(f){var e=b('meta[name="csrf-token"]').attr("content");if(e){f.setRequestHeader("X-CSRF-Token",e)}},refreshCSRFTokens:function(){var e=b("meta[name=csrf-token]").attr("content");var f=b("meta[name=csrf-param]").attr("content");b('form input[name="'+f+'"]').val(e)},fire:function(h,e,g){var f=b.Event(e);h.trigger(f,g);return f.result!==false},confirm:function(e){return confirm(e)},ajax:function(e){return b.ajax(e)},href:function(e){return e.attr("href")},handleRemote:function(j){var e,f,i,n,g,h,m,o;if(a.fire(j,"ajax:before")){n=j.data("cross-domain");g=n===d?null:n;h=j.data("with-credentials")||null;m=j.data("type")||(b.ajaxSettings&&b.ajaxSettings.dataType);if(j.is("form")){e=j.attr("method");f=j.attr("action");i=j.serializeArray();var l=j.data("ujs:submit-button");if(l){i.push(l);j.data("ujs:submit-button",null)}}else{if(j.is(a.inputChangeSelector)){e=j.data("method");f=j.data("url");i=j.serialize();if(j.data("params")){i=i+"&"+j.data("params")}}else{if(j.is(a.buttonClickSelector)){e=j.data("method")||"get";f=j.data("url");i=j.serialize();if(j.data("params")){i=i+"&"+j.data("params")}}else{e=j.data("method");f=a.href(j);i=j.data("params")||null}}}o={type:e||"GET",data:i,dataType:m,beforeSend:function(q,p){if(p.dataType===d){q.setRequestHeader("accept","*/*;q=0.5, "+p.accepts.script)}if(a.fire(j,"ajax:beforeSend",[q,p])){j.trigger("ajax:send",q)}else{return false}},success:function(q,p,r){j.trigger("ajax:success",[q,p,r])},complete:function(q,p){j.trigger("ajax:complete",[q,p])},error:function(r,p,q){j.trigger("ajax:error",[r,p,q])},crossDomain:g};if(h){o.xhrFields={withCredentials:h}}if(f){o.url=f}return a.ajax(o)}else{return false}},handleMethod:function(j){var g=a.href(j),m=j.data("method"),l=j.attr("target"),e=b("meta[name=csrf-token]").attr("content"),h=b("meta[name=csrf-param]").attr("content"),i=b('<form method="post" action="'+g+'"></form>'),f='<input name="_method" value="'+m+'" type="hidden" />';if(h!==d&&e!==d){f+='<input name="'+h+'" value="'+e+'" type="hidden" />'}if(l){i.attr("target",l)}i.hide().append(f).appendTo("body");i.submit()},disableFormElements:function(e){e.find(a.disableSelector).each(function(){var f=b(this),g=f.is("button")?"html":"val";f.data("ujs:enable-with",f[g]());f[g](f.data("disable-with"));f.prop("disabled",true)})},enableFormElements:function(e){e.find(a.enableSelector).each(function(){var f=b(this),g=f.is("button")?"html":"val";if(f.data("ujs:enable-with")){f[g](f.data("ujs:enable-with"))}f.prop("disabled",false)})},allowAction:function(e){var f=e.data("confirm"),g=false,h;if(!f){return true}if(a.fire(e,"confirm")){g=a.confirm(f);h=a.fire(e,"confirm:complete",[g])}return g&&h},blankInputs:function(l,h,j){var g=b(),i,f,e=h||"input,textarea",m=l.find(e);m.each(function(){i=b(this);f=i.is("input[type=checkbox],input[type=radio]")?i.is(":checked"):i.val();if(!f===!j){if(i.is("input[type=radio]")&&m.filter('input[type=radio]:checked[name="'+i.attr("name")+'"]').length){return true}g=g.add(i)}});return g.length?g:false},nonBlankInputs:function(f,e){return a.blankInputs(f,e,true)},stopEverything:function(f){b(f.target).trigger("ujs:everythingStopped");f.stopImmediatePropagation();return false},disableElement:function(e){e.data("ujs:enable-with",e.html());e.html(e.data("disable-with"));e.bind("click.railsDisable",function(f){return a.stopEverything(f)})},enableElement:function(e){if(e.data("ujs:enable-with")!==d){e.html(e.data("ujs:enable-with"));e.removeData("ujs:enable-with")}e.unbind("click.railsDisable")}};if(a.fire(c,"rails:attachBindings")){b.ajaxPrefilter(function(e,g,f){if(!e.crossDomain){a.CSRFProtection(f)}});c.delegate(a.linkDisableSelector,"ajax:complete",function(){a.enableElement(b(this))});c.delegate(a.linkClickSelector,"click.rails",function(j){var h=b(this),l=h.data("method"),i=h.data("params"),g=j.metaKey||j.ctrlKey;if(!a.allowAction(h)){return a.stopEverything(j)}if(!g&&h.is(a.linkDisableSelector)){a.disableElement(h)}if(h.data("remote")!==d){if(g&&(!l||l==="GET")&&!i){return true}var f=a.handleRemote(h);if(f===false){a.enableElement(h)}else{f.error(function(){a.enableElement(h)})}return false}else{if(h.data("method")){a.handleMethod(h);return false}}});c.delegate(a.buttonClickSelector,"click.rails",function(g){var f=b(this);if(!a.allowAction(f)){return a.stopEverything(g)}a.handleRemote(f);return false});c.delegate(a.inputChangeSelector,"change.rails",function(g){var f=b(this);if(!a.allowAction(f)){return a.stopEverything(g)}a.handleRemote(f);return false});c.delegate(a.formSubmitSelector,"submit.rails",function(l){var h=b(this),j=h.data("remote")!==d,g,f;if(!a.allowAction(h)){return a.stopEverything(l)}if(h.attr("novalidate")==d){g=a.blankInputs(h,a.requiredInputSelector);if(g&&a.fire(h,"ajax:aborted:required",[g])){return a.stopEverything(l)}}if(j){f=a.nonBlankInputs(h,a.fileInputSelector);if(f){setTimeout(function(){a.disableFormElements(h)},13);var i=a.fire(h,"ajax:aborted:file",[f]);if(!i){setTimeout(function(){a.enableFormElements(h)},13)}return i}a.handleRemote(h);return false}else{setTimeout(function(){a.disableFormElements(h)},13)}});c.delegate(a.formInputClickSelector,"click.rails",function(g){var f=b(this);if(!a.allowAction(f)){return a.stopEverything(g)}var e=f.attr("name"),h=e?{name:e,value:f.val()}:null;f.closest("form").data("ujs:submit-button",h)});c.delegate(a.formSubmitSelector,"ajax:send.rails",function(e){if(this==e.target){a.disableFormElements(b(this))}});c.delegate(a.formSubmitSelector,"ajax:complete.rails",function(e){if(this==e.target){a.enableFormElements(b(this))}});b(function(){a.refreshCSRFTokens()})}})(jQuery);var SBN=SBN||{};SBN.AdminGear=(function(a){function b(c){a(c.currentTarget).toggleClass("is-active")}return{init:function(){a(".m-admin-gear").on("mouseenter",b);a(".m-admin-gear").on("mouseleave",b)}}})(jQuery);jQuery(function(){SBN.AdminGear.init()});var SBN=SBN||{};SBN.Nav=(function(d){var g=d.browser.msie&&d.browser.version<9;var c=10;var A,s,l,v;function r(I,F,H){if(H){SBN.Nav.siteNav.addClass("is-solid-bg")}var J=d(".m-site-nav__logo img");var E=J.attr("data-dark-logo-url");var G=J.attr("data-light-logo-url");x();_.delay(x,1000);if(!E||!G){return}J.attr("src",(I)?G:E);if(F){var D=J.attr("data-bw-logo-url");if(D){J.attr("src",D)}else{console.log("Tried to apply third logo/black and white logo, but none was available for this site/network.")}}}function j(I,F){if(g){return}I.children("li").css({visibility:"hidden"}).removeClass("is-hidden-desktop");var J=I.find(".m-site-nav__more-link");var H=J.find("ul").empty();var D=F-J.width()-c;var E=0;var G=0;I.children("li").each(function(){var K=d(this);if(!K.is(J)){E+=K.width();if(E<D){K.css("visibility","visible")}else{G++;var L=K.children("a");if(L.length>0){H.append("<li>"+L[0].outerHTML+"</li>")}K.addClass("is-hidden-desktop");K.css("visibility","visible")}}});if(G>0){J.css("visibility","visible")}}function x(){if(Chorus.Environment.currentBreakpoint().index>1){var D=l.width()-v.width();l.find(".m-site-nav__network, .m-site-nav__community").each(function(){j(d(this),D)})}else{l.find("> ul > li").css({visibility:"visible"})}}function i(){s.toggleClass("is-mobile-nav-active")}function e(){clearTimeout(A);if(Chorus.Environment.currentBreakpoint().index>1&&s.hasClass("has-both-navs")===true){s.addClass("is-network-nav-active")}}function f(){s.removeClass("is-network-nav-active");clearTimeout(A)}function b(D){r(D.useLightLogo===true,D.useThirdLogo===true,D.useSolidBackground===true)}function o(D){if(Chorus.Environment.currentBreakpoint().index>1){D.toggleClass("is-active")}}function p(D){if(Chorus.Environment.currentBreakpoint().index<2&&D.hasClass("has-dropdown")){l.find(".is-active").not(D).removeClass("is-active");D.toggleClass("is-active")}}function h(D){o(d(D.currentTarget))}function z(E){var D=d(E.currentTarget);if(D.hasClass("has-dropdown")===true){if(D.hasClass("is-active")===false){E.preventDefault()}}p(D)}function B(D){x()}function w(D){e()}function a(D){A=setTimeout(f,2000)}function q(D){f()}function y(D){d(".m-site-nav__search").addClass("is-focus")}function C(D){d(".m-site-nav__search").removeClass("is-focus")}function n(D){i()}function u(E){var D=d(E.currentTarget);D.find("iframe").css({"background-color":D.css("background-color")});FB.XFBML.parse(document.getElementById("nav-fb-like-btn"))}function m(){s=d(".m-site-nav");l=s.find("nav");v=d(".m-site-nav__right-side");d(".m-site-nav nav > ul > li").on("mouseenter",h).on("mouseleave",h);d(".m-site-nav nav .m-site-nav__community > li").on("click",z);Chorus.EventDispatcher.subscribe("campaignReskinApplied",b);d(window).on("resize",_.debounce(B,100));d(".m-site-nav__netnav-trigger, .m-site-nav__network").on("mouseenter",w);l.on("mouseleave",a);d(".m-site-nav__logo").on("mouseenter",q);d(".m-site-nav__search__input").on("focus",y).on("blur",C);d(".m-site-nav__mobile-trigger").on("click",n);d(".m-site-nav__social-btn").on("mouseenter",u);x()}return{init:function(){m()}}})(jQuery);jQuery(function(){SBN.Nav.init()});var SBN=SBN||{};SBN.UserNav=(function(a){return{init:function(b){this.config(function(){SBN.UserNav.mySbnToggle.off("click",SBN.UserNav.showMySbnModal);SBN.UserNav.mySbnToggle.on("click",SBN.UserNav.showMySbnModal)})},config:function(b){this.mySbnToggle=a("#user-nav-my-sbn");b()},showMySbnModal:function(b){Chorus.EventDispatcher.publish("modal_open",{url:"/modal/mysbn"});b.preventDefault()}}})(jQuery);jQuery(function(){SBN.UserNav.init()});var SBN=SBN||{};SBN.FilterPane=(function(a){return{init:function(){var b=a(".m-filter-pane");if(b.length<1){return}this.config(function(){SBN.FilterPane.cloneToggleEvents();SBN.FilterPane.mobileDropdown.on("change",SBN.FilterPane.triggerMobileChange)})},config:function(b){this.contentToggle=a("#filter-pane-toggle");this.mobileDropdown=a("#filter-pane-toggle-mobile");this.selectedClass="is-selected";b()},cloneToggleEvents:function(){this.contentToggle.find("li").each(function(b,d){var c=a('<option data-index="'+b+'">'+a(this).find("a").text()+"</option>").appendTo(SBN.FilterPane.mobileDropdown);if(a(this).data("count")==0){c.attr("disabled",true)}if(a(this).hasClass(SBN.FilterPane.selectedClass)){c.attr("selected",true)}})},triggerMobileChange:function(c){var b=SBN.FilterPane.mobileDropdown.find(":selected").data("index");SBN.FilterPane.contentToggle.find("li").eq(b).find("a")[0].click()}}})(jQuery);jQuery(function(){SBN.FilterPane.init()});var SBN=SBN||{};SBN.FanShots=(function(a){var b=false;return{init:function(){if(b){return}b=true;this.config(function(){SBN.FanShots.fanshotModalTrigger.on("click",SBN.FanShots.openModal);if(SBN.FanShots.collapseOn.length){SBN.FanShots.collapseImageShots();SBN.FanShots.collapseFanShotBlurbs()}});SBN.UnreadComments.init()},config:function(c){this.fanshotModalTrigger=a("#new-fanshot-trigger");this.fanshotInput=a("#new-fanshot-input");this.form="#new-fanshot-form";this.formTypes="#fanshot-type-toggle li";this.formTypeToggle="#fanshot-type-toggle a";this.typeInput="#type";this.forms=".m-modal-fanshots__details";this.selectedClass="is-selected";this.url=null;this.linkEmbed="#link_shot_url";this.imageEmbed="#image_shot_url";this.videoEmbed="#video_shot_html";this.twitterToggle="#entry_send_to_user_twitter, #entry_send_to_community_twitter";this.twitterBox="#twitter-box";this.tweetLength=110;this.tweetCount="#twitter-count";this.collapseOn=a(".m-fanshot-index, .is-front-page");this.collapsible=a(".m-block__fanshot-media.image");this.collapseToggle=a(".m-fanshot__image-collapse");this.collapsedImageClass="-is-collapsed";this.imageShotMaxHeight=150;this.fanShotBlurbs=a(".m-block.fanshot .m-block__body__blurb");this.blurbMaxWords=15;this.blurbReadMoreClass="m-fanshot__read-more-link";this.blurbReadMore=' ... <a href="" class="'+this.blurbReadMoreClass+'">Read More</a>';c()},openModal:function(){if(Chorus.Context.logged_in){Chorus.EventDispatcher.publish("modal_open",{url:"/modal/new_fanshot",callbacks:{attach:function(){SBN.FanShots.parseUrl()},submit:function(){SBN.FanShots.submitForm()}}})}else{a("#user-nav-login").trigger("click")}return false},switchTypeForm:function(){a(SBN.FanShots.formTypes).removeClass(SBN.FanShots.selectedClass);a(this).parent().addClass(SBN.FanShots.selectedClass);var c=a(this).data("fanshot-type");a(SBN.FanShots.typeInput).val(c);a(SBN.FanShots.forms).hide().filter("#"+c.toLowerCase()).show(0,function(){a(window).trigger("recalculate_modal")});return false},parseUrl:function(){a(SBN.FanShots.formTypeToggle).on("click",SBN.FanShots.switchTypeForm);a(SBN.FanShots.twitterToggle).on("click",SBN.FanShots.toggleTwitterBox);SBN.FanShots.url=SBN.FanShots.fanshotInput.val().replace(/^\s+|\s+$/g,"");a.ajax({type:"POST",url:"/fanshots/lookup",data:{url:SBN.FanShots.url}}).done(function(c){var d=c.shot_type;a(SBN.FanShots.formTypeToggle).filter('[data-fanshot-type="'+d+'"]').trigger("click");if(d=="ImageShot"){a(SBN.FanShots.imageEmbed).val(c.data)}else{if(d=="VideoShot"){a(SBN.FanShots.videoEmbed).val(c.data)}else{a(SBN.FanShots.linkEmbed).val(SBN.FanShots.url)}}})},toggleTwitterBox:function(c){if(a(c.currentTarget).is(":checked")){a(SBN.FanShots.twitterBox).show();a(SBN.FanShots.tweetCount).text(SBN.FanShots.tweetLength);a(SBN.FanShots.twitterBox).find("textarea").on("keyup",SBN.FanShots.countTweetChars)}else{a(SBN.FanShots.twitterBox).hide();a(SBN.FanShots.tweetCount).text("");a(SBN.FanShots.twitterBox).find("textarea").off("keyup",SBN.FanShots.countTweetChars)}},countTweetChars:function(){var d=a(SBN.FanShots.tweetCount);var c=SBN.FanShots.tweetLength-a(SBN.FanShots.twitterBox).find("textarea").val().length;d.text(c);if(c<10&&!d.hasClass("warning")){a(SBN.FanShots.tweetCount).addClass("warning")}else{if(c>10&&d.hasClass("warning")){a(SBN.FanShots.tweetCount).removeClass("warning")}}},submitForm:function(){var f=a(this.form);var g=f.serialize();var d=f.attr("action");var e=a("input:submit",f);var i=0;var h=a(SBN.FanShots.forms).filter(":visible");var c=a(SBN.FanShots.forms).filter(":hidden");h.find('[data-required="true"]').each(function(){if(a.trim(a(this).val())===""){alert("Please fill out all required fields");a(this).focus();i++;return false}});if(i===0){;c.find("input, textarea").val("");a.ajax({type:"POST",url:d,data:g,beforeSend:function(){e.val("Saving...")}}).done(function(j){if(j.status!==200){e.val("Post");alert(j.message)}else{e.val("Saved!");location.reload()}}).fail(function(){e.val("Post");alert("An error occured while saving this fanshot.")})}return false},collapseImageShots:function(){SBN.FanShots.collapsible.each(function(){var d=a(this);var c=d.find("img");d.find("img").on("click",SBN.FanShots.expandImageShots);d.find(SBN.FanShots.collapseToggle).on("click",SBN.FanShots.expandImageShots);d.data("image-height",d.height());if(d.data("image-height")>SBN.FanShots.imageShotMaxHeight){d.addClass(SBN.FanShots.collapsedImageClass).height(SBN.FanShots.imageShotMaxHeight);d.find(SBN.FanShots.collapseToggle).width(c.width())}})},expandImageShots:function(d){var c=a(this).parent();c.removeClass(SBN.FanShots.collapsedImageClass);c.animate({height:c.data("image-height")},100,function(){c.removeClass(SBN.FanShots.collapsedImageClass)});d.preventDefault()},collapseFanShotBlurbs:function(){SBN.FanShots.fanShotBlurbs.each(function(c,d){var g=a(d).find("p");if(g.length===0){return}g.data("full-content",g.html());var f=g.html().match(/<\s*(\w+\b)(?:(?!<\s*\/\s*\1\b)[\s\S])*<\s*\/\s*\1\s*>|\S+/g);if(f.length>SBN.FanShots.blurbMaxWords){g.html(f.slice(0,SBN.FanShots.blurbMaxWords).join(" ")+SBN.FanShots.blurbReadMore);g.find("."+SBN.FanShots.blurbReadMoreClass).on("click",SBN.FanShots.expandFanShotBlurb)}})},expandFanShotBlurb:function(c){var d=a(this).parent();d.html(d.data("full-content"));c.preventDefault()}}})(jQuery);var SBN=SBN||{};SBN.UserProfile=(function(a){return{init:function(){var b=a(".m-profile");if(b.length<1){return}this.config(function(){SBN.UserProfile.activityToggle.on("click","a",SBN.UserProfile.toggleActivity);SBN.UserProfile.blogMembershipToggle.on("click","a",SBN.UserProfile.toggleBlogMembership);SBN.UserProfile.favoriteToggle.on("click",SBN.UserProfile.toggleFavoriteBlog);SBN.UserProfile.adminLinkToggle.on("change",SBN.UserProfile.gotoAdminLink);SBN.UserProfile.coloredRows(SBN.UserProfile.activityTableClass,"tr");SBN.UserProfile.activityToggle.find("a:first").trigger("click")})},config:function(b){this.activityToggle=a("#filter-pane-toggle");this.blogMembershipToggle=a("#blog-membership-toggle");this.blogMembershipList=a(".m-profile__memberships");this.profileRail=a(".m-filter-pane__rail");this.profileRiver=a(".m-filter-pane__content");this.activityTable=a(".m-profile__activity-table");this.activityTableClass=".m-profile__activity-table";this.favoriteToggle=a(".m-profile__blog__favorite");this.adminLinkToggle=a("#profile-meta-link-toggle");this.selectedClass="is-selected";this.disabledClass="is-disabled";this.favoriteClass="is-favorite";this.oddClass="odd";b()},gotoAdminLink:function(c){var b=a(this).val();if(b!==""){window.location=b}},toggleFavoriteBlog:function(d){var b=a(this);var c=b.parent().hasClass(SBN.UserProfile.favoriteClass)?b.data("unfavorite-url"):b.data("favorite-url");a.post(c,function(e){console.log(e);b.parent().toggleClass(SBN.UserProfile.favoriteClass)});d.preventDefault()},toggleActivity:function(){if(!a(this).parent().hasClass(SBN.UserProfile.disabledClass)){var d=a(this).data("type");if(!_.isUndefined(d)){var b=SBN.UserProfile.activityTable.length;var e=b?SBN.UserProfile.activityTable.find("tr"):SBN.UserProfile.profileRiver.find(".m-block");var c=a(this).parents(SBN.UserProfile.activityToggle.selector).find("li");c.removeClass(SBN.UserProfile.selectedClass);a(this).parent().addClass(SBN.UserProfile.selectedClass);if(b){e.removeClass(SBN.UserProfile.oddClass)}e.hide();if(d==="all"){e.show()}else{e.filter("."+d+", ."+d.toLowerCase()).show()}if(b){SBN.UserProfile.coloredRows(SBN.UserProfile.activityTableClass,"tr")}return false}}else{a(this).parent().next().find("a").trigger("click");return false}},toggleBlogMembership:function(){SBN.UserProfile.blogMembershipToggle.find("li").removeClass(SBN.UserProfile.selectedClass);a(this).parent().addClass(SBN.UserProfile.selectedClass);if(a(this).data("show")==="all"){SBN.UserProfile.blogMembershipList.addClass("show-all")}else{SBN.UserProfile.blogMembershipList.removeClass("show-all")}return false},coloredRows:function(b,c){a(b).find(c).filter(":visible").each(function(d,f){if(d%2){a(this).addClass("odd")}})}}})(jQuery);jQuery(function(){SBN.UserProfile.init()});var Chorus=Chorus||{};Chorus.Debug={countCSSRules:function(){var c=log="";if(!document.styleSheets){return}for(var b=0;b<document.styleSheets.length;b++){a(document.styleSheets[b])}function a(f){var g=0;if(f&&f.cssRules){for(var e=0,d=f.cssRules.length;e<d;e++){if(f.cssRules[e].selectorText){g+=f.cssRules[e].selectorText.split(",").length}}log+="\nFile: "+(f.href?f.href:"inline <style> tag");log+="\nRules: "+f.cssRules.length;log+="\nSelectors: "+g;log+="\n--------------------------";if(g>=4096){c+="\n********************************\nWARNING:\n There are "+g+" CSS rules in the stylesheet "+f.href+" - IE will ignore the last "+(g-4096)+" rules!\n"}}}console.log(log);if(c){console.log(c)}}};var SBN=SBN||{};SBN.DelayedLoadGlobalNav=(function(a){return{init:function(){var b=a("#delayedLoadGlobalNavSubItems");b.find(".m-site-nav__dropdown").each(function(c,e){var d=a(e);a("#"+d.data("nav-id")).append(d)});b.remove()}}})(jQuery);var SBN=SBN||{};SBN.StreamFilter=(function(f){var a=".m-stream";var j="data-filter-info";var h="is-selected";var u="#stream-filter-rail li";var b=".m-stream__update";var e="#stream-filter-rail .m-filter-pane__filter-list--mobile";var p="is-hidden";var l=b+"."+p;var m="#m-stream-flag-template";var i="m-stream__hidden-flag";var n="."+i;function c(){f(n).remove()}function d(){var w=f(l);var x=1;var v=_.template(f(m).html());w.each(function(y,C){var A=f(C);var B=A.next();if(B.length>0&&B.hasClass(p)){x+=1}else{var z=f(v({count:x}));z.on("click",r);A.after(z);x=1}})}function g(v){c();f(b).removeClass(p).not(f("*["+j+'*="'+v+'"]')).addClass(p);f(u+"."+h).removeClass(h);f(u+"["+j+'="'+v+'"]').addClass(h);d();Chorus.DynamicSizedImages.initUI(f(".m-stream__update"))}function s(v){var w=v.prev();v.remove();while(w.hasClass(p)){w.removeClass(p);w=w.prev()}}function r(v){s(f(v.currentTarget))}function q(v){g(f(v.currentTarget).attr(j))}function o(v){g(v.target.value)}return{init:function(){if(f(a).length<1){return}f(u+"["+j+"]").on("click",q);f(e).on("change",o);if(f(m).length>0){d()}}}})(jQuery);jQuery(function(){SBN.StreamFilter.init()});var Chorus=Chorus||{};Chorus.LinkShare=(function(e){var g="http://www.facebook.com/share.php?u=",i="http://twitter.com/share?url=",d="https://plus.google.com/share?url=";var c=e(window);function h(l){var m=575,j=400,p=(c.width()-m)/2,o=(c.height()-j)/2,n="status=1,width="+m+",height="+j+",top="+o+",left="+p;window.open(l,"twitter",n)}function b(j){h(g+j)}function f(j){h(i+j)}function a(j){h(d+j)}return{share:function(l,j){if(j==="twitter"){f(l)}if(j==="facebook"){b(l)}if(j==="gplus"){a(l)}}}})(jQuery);var SBN=SBN||{};SBN.ShortLinkTooltip=(function(a){var b=".m-shortlink-tooltip__container";var c="is-active";var h="m-shortlink-tooltip__close";function g(j){j.addClass(c);j.find("input").focus()}function d(j){j.removeClass(c);j.find("input").blur()}function i(m,j){var l=a('<div class="m-shortlink-tooltip"><input type="text" value="'+j+'" /><button class="'+h+'">&times;</button></div>');m.on("mouseenter",e);m.on("click","."+h,f);m.append(l)}function e(j){g(a(j.currentTarget))}function f(j){d(a(j.currentTarget).closest(b))}return{init:function(){a(b).each(function(){var j=a(this);i(j,j.find("a").attr("href"))})}}})(jQuery);jQuery(function(){SBN.ShortLinkTooltip.init()});SBN.StreamEntryLinks=(function(c){var d=c(window);function b(e){e.preventDefault();Chorus.LinkShare.share(d[0].location.href,"facebook")}function a(e){e.preventDefault();Chorus.LinkShare.share(d[0].location.href,"twitter")}return{init:function(){c(".m-stream__update__share-facebook").on("click",b);c(".m-stream__update__share-twitter").on("click",a)}}})(jQuery);jQuery(function(){SBN.StreamEntryLinks.init()});var SBN=SBN||{};SBN.EntryGallery=(function(l){var j=l("body");function g(p){p.next("[data-gallery-full-size]").each(function(q,u){var s=l(u),r=new Image();r.src=s.data("gallery-full-size")})}function m(q){var u=q.data("gallery-full-size"),p=q.closest(".m-gallery");img=p.find(".m-gallery__image"),caption=q.data("gallery-caption"),photo_title=q.data("gallery-title"),fullTitle=(photo_title)?'<span class="gallery-title">'+photo_title+"<span> : "+caption:caption;if(u==img.attr("src")){return}function s(){img.attr("src",u);img.addClass("is-stable");g(q)}if(!img.attr("src")){s()}else{img.removeClassWithAnimationCallback("is-stable",s)}var r=p.find(".m-gallery__thumb").length;p.find(".m-gallery__caption-index").text((q.index()+1)+" of "+r);p.find(".m-gallery__caption-body").html(fullTitle);ga("send","event","Gallery","Load Image",p.data("gallery-id"))}function b(q){if(q.hasClass("is-selected")==true){return}var p=q.closest(".m-gallery");var r=q.closest(".m-gallery__metadata");r.find(".is-selected").removeClass("is-selected");q.addClass("is-selected");var s=q.position().left-(0.5*p.width())+(0.5*q.width());if(s<0){s=0}s=0-s;r.css({left:s})}function f(p){m(p);b(p)}function h(p,s){var r=p.find(".m-gallery__thumb.is-selected");var q;if(r.length==0||(s&&r.is(":last-child"))){q=p.find(".m-gallery__thumb").first()}else{if(!s&&r.is(":first-child")){q=p.find(".m-gallery__thumb").last()}else{q=r[(s)?"next":"prev"]()}}e(q)}function e(p){window.location.hash=p.data("gallery-id")}function a(){l(".m-gallery__nav .prev").trigger("click")}function d(){l(".m-gallery__nav .next").trigger("click")}function c(p){if(p.keyCode===37){a()}if(p.keyCode===39){d()}}function o(p){p.preventDefault();h(l(p.currentTarget).closest(".m-gallery"),true)}function n(p){p.preventDefault();h(l(p.currentTarget).closest(".m-gallery"),false)}function i(q){var p=q.value.substring(1);var r=l('.m-gallery__thumb[data-gallery-id="'+p+'"]');if(r.length<1){return}f(r)}return{init:function(q){var p=l(".m-gallery");if(p.length<1){return}l.address.change(i);j.on("keydown",c);l(".m-gallery__nav .prev").on("click",n);l(".m-gallery__nav .next").on("click",o);l(".m-gallery__thumb:first-child").not('[data-gallery-id="'+l.address.value().substring(1)+'"]').each(function(r,s){f(l(s))})}}})(jQuery);jQuery(function(){SBN.EntryGallery.init()});var SBN=SBN||{};SBN.AdminActions=(function(g){var p=".m-admin-button";var m=p+".check-permissions";var b=".m-entry__admin";var l="#inspect-images-link";var u="is-active";var f="admin-actions-id";var o="/sbn_modals/admin_actions/";var j="/sbn_modals/admin_image_sizes/";var a="/sbn_entries/check_admin_permissions/";function h(w){g(b+"[data-"+f+'="'+w+'"]').addClass(u)}function e(w){g(b+"[data-"+f+'="'+w+'"]').removeClass(u)}function c(w){Chorus.EventDispatcher.publish("modal_open",{url:o+w,callbacks:{attach:function(){g(l).on("click",d)}}})}function r(w){Chorus.EventDispatcher.publish("modal_open",{url:j+w})}function n(){var w=g(m).map(function(x,y){return g(y).data(f)});w=_.uniq(_.compact(w)).sort();if(w.length){g.get(a+w.join(","),v)}}function v(w){_.each(w,function(x,y){if(x){g("[data-"+f+"="+y+"]"+m).show()}})}function s(w){h(g(w.currentTarget).data(f))}function i(w){e(g(w.currentTarget).data(f))}function q(w){var y=g(w.currentTarget).data(f);var x=g(b+"[data-"+f+'="'+y+'"]');if(x.length<1){w.preventDefault();c(y)}}function d(w){w.preventDefault();r(g(w.currentTarget).data(f))}return{init:function(){if(Chorus.Environment.currentBreakpoint().index>1){g(b).on("mouseleave",i);g(p).on("mouseenter",s);g(p).on("click",q);g(l).on("click",d)}if(Chorus.Context.logged_in){n()}}}})(jQuery);jQuery(function(){SBN.AdminActions.init()});var Chorus=Chorus||{};Chorus.EntryResponsiveVideo=(function(f){var h=".m-entry__body";var e=['iframe[src*="youtube.com"]','iframe[src*="instagram.com"]','iframe[src*="ooyala.com"]'].join(",");var d=["div[id*=ooyalaPlayer]",".m-video__pane iframe",".mceItemFlash",".m-block__fanshot-media.video iframe",".m-block__fanshot-media.video object",".sbn-body-feature .sbn-feature-entry .feature-body iframe"].join(",");function b(){g(f(h));f(d).each(c)}function g(i){i.find(e).each(c)}function c(){var i="";$this=f(this);if($this.hasClass("no-responsive-video")||$this.parents(".no-responsive-video").length){return true}else{if(/instagram\.com/.test($this.attr("src"))){i=" instagram"}}$this.find("object, embed, video").attr("width","100%").attr("height","100%");$this.find("div.OoyalaHtml5VideoPlayer").css({width:"100%",height:"100%"});$this.removeAttr("width").removeAttr("height").wrap('<div class="p-scalable-video'+i+'"></div>');return true}function a(j){var i=setTimeout(function(){j();clearTimeout(i)},1000)}return{wrapVideosInEntryBody:function(i){a(function(){g(i)})},init:function(){a(b)}}})(jQuery);jQuery(function(){Chorus.EntryResponsiveVideo.init()});var SBN=SBN||{};SBN.FeaturedPoll=(function(c){var n=".m-poll-body";var j=".m-poll-body__view-results";var r=".m-poll-body__submit";var i=".m-poll-body__options";var g=".m-poll-body__controls";var a=".m-poll-body__options li";var m=".m-poll-body__count";var f="poll-id";var q="#m-poll-body-result";var h="/polls/results_json";var l="/polls/vote_json";function p(v){return c(n+"[data-"+f+'="'+v+'"]')}function u(x){var D=_.template(c(q).html());var A=p(x.poll_id);var B=A.find(i);var w=0;for(var y=x.options.length-1;y>-1;y--){w+=x.options[y].poll_option.votes}A.find(m).html("<i>"+w+" vote"+((w==1)?"":"s")+" total</i>");A.find(a).remove();A.find(g).remove();for(var y=0,z=x.options.length;y<z;y++){var v=x.options[y].poll_option;var C=parseFloat(v.votes/w)||0,C=Math.round(C*100);B.append(D({title:v.title,votes:v.votes,percentage:C}))}}function d(w){var v=p(w);c.ajax({url:h,data:{id:w},success:o})}function s(x){var w=p(x);var v=w.find("input:radio:checked");if(v.length>0){c.ajax({url:l,dataType:"json",data:{poll_option:v[0].value,id:x},type:"POST",success:o})}}function b(v){v.preventDefault();d(v.data.pollId)}function e(v){v.preventDefault();s(v.data.pollId)}function o(v){u(v)}return{init:function(){c(n).each(function(){var v=c(this);var w=v.data(f);v.find(j).on("click",{pollId:w},b);v.find(r).on("click",{pollId:w},e)})}}})(jQuery);var SBN=SBN||{};SBN.FlagEntry=(function(g){var s=".m-flag-button";var r=".m-flag-button__unflag";var b=".m-flag-button__view";var q=".m-flag-button-wrapper";var f=".m-modal-flag__form";var e="flag-id";var i="flag-init";function m(u){Chorus.EventDispatcher.publish("modal_open",{url:u})}function l(u){Chorus.EventDispatcher.publish("modal_open",{url:u})}function j(u){var v=confirm("Pressing OK will remove the flag you placed on this entry. Cancel will leave it in place.");if(v==true){g.post(u,n,"json")}}function c(u){var v=u.attr("action");g.post(v,u.serializeObject(),a,"json")}function o(u){g(q+"[data-"+e+'="'+u.id+'"]').replaceWith(u.markup);SBN.FlagEntry.init()}function h(u){u.preventDefault();c(g(u.currentTarget))}function a(u){Chorus.EventDispatcher.publish("close");o(u)}function n(u){o(u)}function d(){g(f).on("submit",h)}function p(w){w.preventDefault();var u=g(w.currentTarget);var v=u.find("a");if(u.has(b).length>0){l(v.attr("href"));return}if(u.has(r).length>0){j(v.attr("href"));return}m(v.attr("href"))}return{init:function(){g(s).each(function(){var u=g(this);if(!u.data(i)){u.data(i,true);u.on("click",p)}})}}})(jQuery);jQuery(function(){SBN.FlagEntry.init()});var Chorus=Chorus||{};Chorus.ToggleLink=(function(c){var b="a[data-toggle-url]";function a(){var d=c(this);var e=d.data();if(e.toggleInProcess){return false}if(e.toggleText){oldText=d.text();d.text(e.toggleText)}e.toggleInProcess=true;c.ajax({url:d.attr("href"),type:e.toggleMethod||"POST",dataType:"text",success:function(){e.toggleText=oldText;if(e.toggleUrl){var f=e.toggleUrl;d.attr("href",e.toggleUrl);e.toggleUrl=f}e.toggleInProcess=false},error:function(){d.text(oldText);e.toggleInProcess=false;alert("An unknown error occurred. Please try again later.")}});return false}return{init:function(){c(document).on("click",b,a)}}})(jQuery);jQuery(function(){Chorus.ToggleLink.init()});var SBN=SBN||{};SBN.GoogleAnalyticsTrackAction=(function(d){var b=".ga-track-click";var c="ga-track-click-params";function a(e){Util.uaTrackEvent(e)}return{init:function(){d(b).each(function(){var e=d(this);e.on("click",e.data(c),a)})}}})(jQuery);jQuery(function(){SBN.GoogleAnalyticsTrackAction.init()});var SBN=SBN||{};SBN.entryDropCap=(function(a){return{init:function(){var b=a(".m-entry__body > p:first-child");if(typeof b!=="undefined"){b=b.first();var c=b.text();if(c.match(/^[a-zA-Z]/)!==null&&c.length>170&&c.split(" ").length>30){b.addClass("has-dropcap")}}}}})(jQuery);jQuery(function(){SBN.entryDropCap.init()});SBN.EntryTableSupport=function(b){function a(){b(".m-entry__body table:not([class]), .m-entry__body .sports_data_widget table").addClass("sbn-data-table").removeClass("zebra");b(".sbn-data-table, .sports_data_widget .zebra").zebraTables();var c=b(".m-entry__body").width();b(".m-entry__body table").each(function(d,f){var e=b(f);var g=b(f).width();if(g>c){e.wrap('<div class="overflow-wrapper"></div>')}})}return{init:function(c){a()}}}(jQuery);jQuery(function(){SBN.EntryTableSupport.init()});var SBN=SBN||{};SBN.SocialCount=(function(e){var d={};var f={};function b(g,h){if(f[g]){h(f[g]);return}e.ajax({url:"http://cdn.api.twitter.com/1/urls/count.json",dataType:"jsonp",data:{url:g},success:function(i){f[g]=i.count;h(i.count)}})}function a(g,h){if(d[g]){h(d[g]);return}Chorus.EventDispatcher.subscribe("facebookSdkAvailable",function(){FB.api({method:"fql.query",query:"SELECT total_count FROM link_stat WHERE url = '"+g+"'"},function(i){d[g]=i[0].total_count;h(i[0].total_count)})})}function c(){e("[data-facebook-share-count-url]").each(function(){var g=e(this);a(g.data("facebook-share-count-url"),function(h){if(h>0){if(g.data("use-parens")===false){g.text(h).redraw()}else{g.text("("+h+")").redraw()}}})});e("[data-twitter-share-count-url]").each(function(){var g=e(this);b(g.data("twitter-share-count-url"),function(h){if(h>0){if(g.data("use-parens")===false){g.text(h).redraw()}else{g.text("("+h+")").redraw()}}})})}return{init:function(){c()}}})(jQuery);jQuery(function(){SBN.SocialCount.init()});var SBN=SBN||{};SBN.GroupHead=(function(b){function a(d){if(d){b(".p-header-group").addClass("is-light-color")}}function c(d){a(d.useLightLogo===true)}return{init:function(){Chorus.EventDispatcher.subscribe("campaignReskinApplied",c)}}})(jQuery);jQuery(function(){SBN.GroupHead.init()});var SBN=SBN||{};SBN.UnreadComments=(function(e){var f="data-unread-comments-id";var i="unread-comments-id";var d="unread-comments-token";var h="unread-comments-token-before";var b="/comments/unread_counts/";var c=Util.getUrlVars().debugUnreadComments===true;function g(j){console.log("SBN.UnreadComments: requestUnreadCommentCounts called");var j=j||e("body");var l=j.find("*["+f+"]").map(function(m,n){return e(n).data(i)});l=_.uniq(l).sort();if(c===true){console.log("SBN.UnreadComments: Requesting Unread Comments for :",l)}if(l.length>0){e.get(b+l.join(","),a,"json")}}function a(j){if(c===true){console.log("SBN.UnreadComments: Data Returned:",j)}_.each(j,function(l,m){e("["+f+'="'+m+'"]').each(function(o,q){var r=l;$item=e(q);var p=$item.data(d);if(p){r+=" "+p}var n=$item.data(h);if(n){r=n+r}$item.text(r).addClass("loaded")})})}return{init:function(){if(Chorus.Context.logged_in){g()}},applyTo:function(j){if(Chorus.Context.logged_in){g(j)}}}})(jQuery);jQuery(function(){SBN.UnreadComments.init()});var SBN=SBN||{};SBN.SearchFormToggler=(function(e){var i="#search-type-toggle";var a="is-selected";var f=i+" ."+a;var d="#search-advanced";var b="#search-basic";var c="show-search-state";function h(j){e(f).removeClass(a);e(i).find("*[data-"+c+'="'+((j)?"advanced":"basic")+'"]').parent().addClass(a);e(d)[(j)?"show":"hide"]();e(b)[(j)?"hide":"show"]()}function g(j){j.preventDefault();h(e(j.target).data(c)=="advanced")}return{init:function(){var j=e(i);if(j.length<1){return}j.on("click",g)}}})(jQuery);jQuery(function(){SBN.SearchFormToggler.init()});var SBN=SBN||{};SBN.BreakingNews=(function(f){var a=".m-breaking-news";var e="breaking-news-id";var d='<div class="m-breaking-news__close">&times;</div>';var b="breaking_news_";function g(){var h=f(a);var i=h.data(e);f.cookie(b+i,"true",{expires:365,path:"/"});h.remove()}function c(h){g()}return{init:function(){var i=f(a);if(i.length>1||Chorus.Context.logged_in==false){return}var h=f(d);h.on("click",c);i.append(h)}}})(jQuery);jQuery(function(){SBN.BreakingNews.init()});var SBN=SBN||{};SBN.LookitCover=(function(h){var b=h(window);var n;function i(r){var p=r.data.main;var q=p.width();p.removeClass("lookit-size-sm lookit-size-md lookit-size-lg");if(q<470){p.addClass("lookit-size-sm");return}if(q<730){p.addClass("lookit-size-md");return}p.addClass("lookit-size-lg")}function o(q,p){q.data("carousel-nav-index",p);q.find(".is-active").addClassWithAnimationCallback("is-animating",function(r){h(r).removeClass("is-animating")}).removeClass("is-active");q.find(".lookit-cover-nav li:eq("+p+"), .lookit-box:eq("+p+")").addClassWithAnimationCallback("is-animating",function(r){h(r).removeClass("is-animating")}).addClass("is-active")}function f(p){var q=p.data("carousel-nav-index")+1;if(q>p.data("carousel-pane-last-index")){q=0}o(p,q)}function a(p){var q=p.data("carousel-nav-index")-1;if(q<0){q=p.data("carousel-pane-last-index")}o(p,q)}function g(){clearInterval(n);n=undefined}function e(){n=window.setInterval(function(){h(".lookit-cover-next").trigger("click")},4000)}function c(q){q.preventDefault();var p=q.data.main;o(p,h(q.currentTarget).data("carousel-nav-index"))}function l(q){q.preventDefault();var p=q.data.main;a(p)}function m(q){q.preventDefault();var p=q.data.main;f(p)}function j(){event.preventDefault();var p=event.data.main;g();a(p)}function d(){event.preventDefault();var p=event.data.main;g();f(p)}return{init:function(){var p=h(".lookit-cover");if(p.length<1){return}p.each(function(q,s){var r=h(s);r.data("carousel-pane-last-index",r.find(".lookit-box").length-1);r.find(".lookit-cover-nav li").bind("click",{main:r},c);r.find(".lookit-cover-prev").bind("click",{main:r},l);r.find(".lookit-cover-next").bind("click",{main:r},m);r.swipe({swipeLeft:function(v){d(h.extend(true,v,{data:{main:r}}))},swipeRight:function(v){j(h.extend(true,v,{data:{main:r}}))},threshold:100,fingers:1});r.bind("mouseenter",g);r.bind("mouseleave",e);var u=r.find(".is-active");i({data:{main:r}});b.bind("resizeStop",{main:r},i);if(u.length>0){o(r,u.index())}else{o(r,0)}});e()}}})(jQuery);jQuery(function(){SBN.LookitCover.init()});var SBN=SBN||{};SBN.LookitCarousel=(function(g){var b=g(window);function e(n){var o=n.width();n.removeClass("display-3-up display-4-up display-5-up, lookit-size-sm, lookit-size-md, lookit-size-lg");if(o<600){n.addClass("display-2-up lookit-size-sm");n.data("carousel-boxes-per-pane",2);return}if(o<900){n.addClass("display-3-up lookit-size-md");n.data("carousel-boxes-per-pane",3);return}n.addClass("display-4-up lookit-size-lg");n.data("carousel-boxes-per-pane",4)}function c(o){var n=o.width();var p=o.data("carousel-boxes-per-pane");var r=n/p;var q=o.find(".lookit-box");o.data("carousel-pane-width",n);o.data("carousel-box-width",r);o.data("carousel-full-panes",Math.floor(q.length/p));o.data("carousel-boxes-per-last-pane",q.length%p);q.css({height:r+"px"});o.find(".lookit-box-micro-inner").css({width:r+"px",height:r+"px"})}function m(q,w){var o=q.data("carousel-full-panes");var v=(q.data("carousel-boxes-per-last-pane")>0)?1:0;var n=o+v;var s=q.data("carousel-box-width");var u=q.data("carousel-pane-width");var r;if(w+1>n){w=0}if(w<0){w=n-1}if(w+1>o){r=(o*u)-(s*(q.data("carousel-boxes-per-pane")-q.data("carousel-boxes-per-last-pane")))}else{r=w*u}var p=q.find(".lookit-carousel-entries").css("left","-"+r+"px");q.data("carousel-current-pane",w);Chorus.DynamicSizedImages.initUI(g(".lookit-carousel-entries"))}function f(n){var o=n.data("carousel-current-pane")+1;m(n,o)}function a(n){var o=n.data("carousel-current-pane")-1;m(n,o)}function i(o){o.preventDefault();var n=o.data.main;a(n)}function l(o){o.preventDefault();var n=o.data.main;f(n)}function d(o){var n=o.data.main;f(n)}function h(o){var n=o.data.main;a(n)}function j(o){var n=o.data.main;var p=n.data("carousel-current-pane")||0;e(n);c(n);m(n,p)}return{init:function(){var n=g(".lookit-carousel");if(n.length<1){return}n.each(function(o,q){var p=g(q);p.swipe({swipeLeft:function(s){d(g.extend(true,s,{data:{main:p}}))},swipeRight:function(s){h(g.extend(true,s,{data:{main:p}}))},threshold:100,fingers:1});p.find(".lookit-carousel-prev").bind("click",{main:p},i);p.find(".lookit-carousel-next").bind("click",{main:p},l);var r=p.data("carousel-current-pane")||0;b.bind("resizeStop",{main:p},j);j({data:{main:p}});Chorus.EventDispatcher.subscribe("campaignReskinApplied",function(){var s=setTimeout(function(){clearTimeout(s);j({data:{main:p}})},1000)})})}}})(jQuery);jQuery(function(){SBN.LookitCarousel.init()});var SBN=SBN||{};SBN.LookitTagBrowser=(function(a){return{init:function(){var b=a(".lookit-tag-browser");if(b.length<1){return}b.each(function(c,f){var d=a(f);var e=d.find("ul").width();d.find("li").each(function(g,i){var h=a(i);if((h.position().left+h.width())>e){h.addClass("is-hidden")}})})}}})(jQuery);jQuery(function(){SBN.LookitTagBrowser.init()});var SBN=SBN||{};SBN.LookitTweetShot=(function(a){return{init:function(){a(".lookit-box-tweet").on("click",function(){window.location=a(this).data("href")})}}})(jQuery);jQuery(function(){SBN.LookitTweetShot.init()});var SBN=SBN||{};SBN.LivePromo=(function(b){function a(){b(".m-live-promo").addClass("is-negative-color");var c=b(".m-live-promo .m-live-promo__logo img");c.attr("src",c.data("light-logo-url"))}return{init:function(){Chorus.EventDispatcher.subscribe("campaignReskinApplied",function(c){if(c.useLightLogo===true){a()}})}}})(jQuery);jQuery(function(){SBN.LivePromo.init()});var SBN=SBN||{};SBN.Scoreboard=(function(i){var b="/sbn_scoreboard/ajax_leagues_and_events",j=300000,h=1000;var s=null;var x=null;var z={url:b,ranges:{},events:[]};var y=new Date().getTime();var p=null;var F=null;function C(J){var I=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][J.getDay()]+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][J.getMonth()]+" "+J.getDate()+", "+J.getFullYear();return I}function c(L){var I=L.getHours();var K=L.getMinutes();var J=I>11?"PM":"AM";var M=L.toString().split("(")[1].split(")")[0];I=(I==0)?12:(I>12)?(I-12):I;K=(K<10)?"0"+K:K;return I+":"+K+""+J+" "+M}function B(I,J){r();e(I);D()}function a(I,J){r();d("there was an error loading the score")}function u(I,J){y=new Date().getTime();D()}function d(J){var I=x({message:J});i(".m-scoreboard__error-message").remove();i(".m-scoreboard__meta").append(I);SBN.DismissableMessage.init(i(".m-scoreboard__error-message"))}function m(){i(".m-scoreboard__error-message").removeClass("is-visible")}function o(I){G(I);var J=i('.m-scoreboard[data-scoreboard-league="'+I+'"]');if(J.data("scoreboard-hide-if-empty")==true){J.remove();i('.m-scoreboard__link a[href*="/scoreboard/'+J.data("scoreboard-league")+'"]').parent().remove()}else{J.find(".m-scoreboard__empty-league").remove();J.append('<div class="m-scoreboard__empty-league">There are no games scheduled for today.</div>')}}function n(){i(".m-scoreboard .m-scoreboard__loading").html('<div class="m-scoreboard__empty-league">There were no events found that match the request.</div>')}function G(I){i('.m-scoreboard[data-scoreboard-event-id="'+I+'"] .m-scoreboard__loading, .m-scoreboard[data-scoreboard-league="'+I+'"] .m-scoreboard__loading').remove()}function H(K,J,I){var L="Scores for ";if(I&&I!=="Day"){L+="the "+I.toLowerCase()+" of "}L+=C(new Date(J.from));if(I&&I!=="Day"){L+=" - "+C(new Date(J.until))}i('.m-scoreboard[data-scoreboard-league="'+K+'"] .m-scoreboard__date').html(L)}function w(L,K){var N=new Date(L.start_time);L.event_time=C(N)+" - "+c(N);var M=s(L);var I=i('.m-scoreboard__box-score[data-scoreboard-event-id="'+L.id+'"]');if(I.length>0){I.replaceWith(M);return}var J=i('.m-scoreboard[data-scoreboard-event-id="'+L.id+'"] .m-scoreboard__table-attach, .m-scoreboard[data-scoreboard-league="'+K+'"] .m-scoreboard__table-attach');if(J.length>0){J.append(M);return}console.warn("data was recieved that is an unrequested event id, or is part of a league that cannot be found in the dom. data = ",L,"league = ",K)}function E(J,I){J=new Date(J.dateModified);I=new Date(I.dateModified);return J>I?-1:J<I?1:0}function v(J){var N=[],K=[],M=[],O=[],P=[];for(var L=0,I=J.length;L<I;L++){switch(J[L].status){case"mid-event":N.push(J[L]);break;case"post-event":M.push(J[L]);break;case"postponed":case"weather-delay":K.push(J[L]);break;case"pre-event":O.push(J[L]);break;default:P.push(J[L])}}return N.sort(E).concat(K.sort(E),M.sort(E),O.sort(E),P.sort(E))}function f(J,M){if(M!==undefined){if(J.length===0){o(M)}else{G(M)}}var L=v(J);for(var K=0,I=L.length;K<I;K++){w(L[K],M);if(M===undefined){G(L[K].id)}}}function e(J){f(J.events);for(var I in J.leagues){f(J.leagues[I],I)}n()}function l(){var K=new Date().getTime()-y;var L=j-K;var J=Math.floor(L/60000);var I=Math.floor(L/1000)%60;I=(I<10)?"0"+I.toString():I.toString();i(".m-scoreboard__counter-bar").width((L/j)*100+"%")}function A(){i(".m-scoreboard__counter-time").html("")}function g(){i.ajax({dataType:"jsonp",url:z.url,data:{ranges:z.ranges,events:z.events},success:B,error:a,complete:u})}function D(){r();F=setInterval(l,h);p=setTimeout(q,j)}function q(){r();g()}function r(){A();clearInterval(F);clearTimeout(p)}return{init:function(){var I=i(".m-scoreboard");if(I.length<1){return}s=_.template(i("#scoreboard-boxscore-template").html());x=_.template(i("#scoreboard-error-template").html());I.each(function(){var L=i(this);if(L.data("scoreboard-event-id")){z.events.push(L.data("scoreboard-event-id"))}else{var M=L.data("scoreboard-league");var J=L.data("scoreboard-date-range");var K=L.data("scoreboard-interval");z.ranges[M]=J;H(M,J,K)}});g()}}})(jQuery);jQuery(SBN.Scoreboard.init);var SBN=SBN||{};SBN.SocialPromo=(function(d){var a=(Chorus.Context.ga_track_prefix)?Chorus.Context.ga_track_prefix+"_trackEvent":"_trackEvent";function f(h,i){SBN.DataStore.set(h,i)}function g(h){return SBN.DataStore.get(h)}function b(h){if(h.hasClass("m-social-promo__fixed-bg")){return"fixed-bg"}if(h.hasClass("m-social-promo__subnav")){return"subnav"}if(h.hasClass("m-social-promo__slideout")){return"slideout"}return"unkown unit"}function e(h){var i=d(".m-social-promo__unit");ga("send","event","House Promos",h,b(i),{nonInteraction:true});f("social-promo-hidden",1);i.remove()}function c(){var h=d(".m-social-promo__unit");if(h.length<1){return}h.addClass("is-active");h.find(".m-social-promo__close").on("click",function(m){m.preventDefault();e("close")});Chorus.EventDispatcher.subscribe("facebookSdkAvailable",function(){FB.Event.subscribe("edge.create",function(m){if(/ref=promo$/.test(m)){e("like")}})});window.twttr=window.twttr||(t={_e:[],ready:function(m){t._e.push(m)}});twttr.ready(function(m){m.widgets.createFollowButton(Chorus.Context.community_twitter_screen_name,document.getElementById("social-promo-twitter-follow-button"),function(n){m.events.bind("follow",function(o){if(o.target==null){e("follow")}})},{size:"medium",count:"horizontal"})});if(jQuery(".m-live-promo").length>0){d(".m-social-promo__subnav").remove()}var l=d(document);var j=function(){if(l.scrollTop()>=400){d(".m-social-promo__slideout").addClass("is-available");window.clearInterval(i)}};var i=window.setInterval(j,5000)}return{init:function(){if(Util.isReferrerCurrentDomain()||(Chorus.Context.community_domain==="sbnation.com"&&Util.isReferrerSocialDomain())||parseInt(g("social-promo-hidden"))===1){return}c()}}})(jQuery);jQuery(function(){SBN.SocialPromo.init()});var SBN=SBN||{};SBN.DismissableMessage=(function(d){function c(e){e.removeClass("is-visible")}function b(f){if(event&&event.preventDefault){event.preventDefault()}c(d(event.currentTarget))}function a(e){e.on("click",".dismiss",b)}return{init:function(e){if(e){a(e)}else{a(d(".p-dismissible-message"))}}}})(jQuery);SBN.NewsletterSignup=function(i){function p(){var s=i(".m-newsletter-signup form");var q=[];var r=[];i("#selected-newsletters li").each(function(u,v){v=i(v);q.push(v.attr("data-list_id"));r.push(v.attr("data-team_id"))});i("#lists_").val(q.toString());i("#team_ids_").val(r.toString());d();i.ajax({type:"POST",url:s.attr("action"),data:s.serialize(),success:l,error:m})}function b(q){var r="li[data-list_id = '"+q.data("list_id")+"'][data-team_id = '"+q.data("team_id")+"']";return r}function h(r){var q=b(r);i(".m-newsletter-signup__section").find(q).addClass("is-selected");i("#selected-newsletters").append('<li class="is-selectable is-selected" data-list_id="'+r.data("list_id")+'" data-team_id="'+r.data("team_id")+'">'+r.text()+"</li>")}function a(r){var q=b(r);i("#selected-newsletters").find(q).remove();i(".m-newsletter-signup__section").find(q).removeClass("is-selected")}function o(){var q=i(".m-newsletter-signup__left-rail-field");if(q.val().indexOf("@")<1){c();return false}return true}function d(){i("#newsletter_submit").val("Submiting").attr("disabled","disabled")}function c(){i(".m-newsletter-signup__left-rail-field").after('<span class="p-err-msg">There appears to be a problem with that email address.</span>')}function l(){i("#newsletter_submit").after('<span class="p-confirm-msg">Your submission went through.</span>')}function j(){i("#newsletter_submit").after('<span class="p-err-msg">There was an error loading the request</span>')}function g(){i("#newsletter_submit").val("Sign Up").removeAttr("disabled");i(".m-newsletter-signup .p-err-msg, .m-newsletter-signup .p-confirm-msg").remove()}function n(q){g();showSuccess()}function m(q){g();j()}function e(r){var q=i(r.currentTarget);if(q.hasClass("is-selected")){a(q)}else{h(q)}}function f(q){q.preventDefault();g();if(o()){p()}}return{init:function(){i(".m-newsletter-signup").on("click",".is-selectable",e);i("#newsletter_submit").on("click",f)}}}(jQuery);jQuery(function(){SBN.NewsletterSignup.init()});var SBN=SBN||{};SBN.SiteDirectory=(function(e){var j,b,d,i,m;function f(n){if(j.val().length<3){c()}else{i.hide();m.each(function(o,q){var p=e(q),s=p.text().toUpperCase(),r=j.val().toUpperCase();p.toggle(s.indexOf(r)>=0)})}}function c(n){i.show();m.show();b.find(".is-selected").removeClass("is-selected");b.find('a[href="#all"]').parent().addClass("is-selected")}function h(n){b.find(".is-selected").removeClass("is-selected");b.find('a[href="#'+n+'"]').parent().addClass("is-selected");i.hide();m.hide();e("#"+n).show().nextUntil("h2").show()}function a(n){n.preventDefault();f(true)}function g(n){n.preventDefault();var o=e(n.currentTarget).val();if(o==="all"){c()}else{h(o)}}function l(n){n.preventDefault();var o=e(n.currentTarget).attr("href").substr(1);if(o==="all"){c()}else{h(o)}}return{init:function(){var n=e(".m-sitedir");if(n.length<1){return}j=e("#blog-query");d=e("#blog-select");b=e("#blog-filter");i=e(".m-sitedir .m-filter-pane__content").find("h2, h3, h4").not(".m-sitedir__entry-title");m=e(".m-sitedir__entry");j.on("keyup",_.debounce(a,500));d.on("change",g);b.on("click","a",l)}}})(jQuery);jQuery(SBN.SiteDirectory.init);var SBN=SBN||{};SBN.Fanposts=(function(b){function a(c){if(!Chorus.Context.logged_in){c.preventDefault();Chorus.Auth.modal.open("login")}}return{init:function(){b(".m-fanpost-index__new-link, .m-rock-fanpost__new").on("click",a)}}})(jQuery);jQuery(function(){SBN.Fanposts.init()});var SBN=SBN||{};SBN.AutoTabs=(function(d){function b(){if(window.location.hash!==""){return window.location.hash.substring(1)}else{return null}}function a(f,g){f.find(".is-selected").removeClass("is-selected");f.find('.m-autotabs__content[id="'+g+'"]').add(f.find('.p-tabs a[href="#'+g+'"]').closest("li")).addClass("is-selected")}function e(f){var l=f.find(".m-autotabs__content");var h='<ul class="p-tabs">[% _.each(data.tabs, function(tab) { %] <li><a href="#[%= tab.id %]">[%= tab.label %]</a></li> [% }); %]</ul>';var j={tabs:_.map(l,function(m){var m=d(m);return{id:m.attr("id"),label:m.data("autotabs-label")}})};var i=_.template(h,j);var g=d(i);l.first().before(g)}function c(g){g.preventDefault();var f=d(g.currentTarget);a(f.closest(".m-autotabs"),f.attr("href").substring(1))}return{init:function(){var f=d(".m-autotabs");if(f.length<1){return}f.each(function(){e(d(this))});f.on("click",".p-tabs a",c);var g=b();if(g!==null){f.find('.p-tabs a[href="#'+g+'"]').trigger("click")}else{f.find(".p-tabs a").first().trigger("click")}}}})(jQuery);jQuery(SBN.AutoTabs.init);var SBN=SBN||{};SBN.PtePlayer=(function(a){function b(c){c.preventDefault();a(".sbn-pte-head-player-stats-toggle").remove();a(".sbn-pte-table-player tr").addClass("ui-state-open")}return{init:function(){a(".sbn-pte-head-player-stats-toggle").on("click",b)}}})(jQuery);jQuery(function(){SBN.PtePlayer.init()});var SBN=SBN||{};SBN.FullArchive=(function(e){e(function(){SBN.FullArchive.init()});var f={entries_for_month_data:"/sbn_full_archive/entries_by_month",entries_by_year:"archives/full/:year"};function d(h){c(e(h.currentTarget()).val())}function b(i){var j=e(i);var h=e('.m-full-archive__entries[data-full-archive-year="'+j.data("full-archive-year")+'"][data-full-archive-month="'+j.data("full-archive-month")+'"]');h.replaceWith(j);SBN.UnreadComments.applyTo(j)}function a(h){alert("There was an error loading data from the server")}function g(i,h){e.ajax(f.entries_for_month_data,{data:{month:h,year:i},dataType:"html",error:a,success:b})}function c(h){window.location=f.entries_by_year.replace(":year",h.toString())}return{init:function(){if(e(".m-full-archive").length<1){return}e("select.m-full-archive__year").on("change",d);e(".m-full-archive__entries").each(function(){var h=e(this);g(h.data("full-archive-year"),h.data("full-archive-month"))})}}})(jQuery);var SBN=SBN||{};SBN.VideoBrowser=(function(g){var d=".m-video-browser",i="video-browser",f=".m-video-browser__player",l="a",u=".m-video-browser__playlist",A=".m-video-browser__item",w=".m-video-browser__item a",s=".m-video-browser__headline-title",p="is-selected",o="is-playing",c="video-title",j="video-chorus-id",r="video-embed-code",x="m-video-browser__playlist_btn up",q="m-video-browser__playlist_btn is-active down";function z(E){var B=g(f);var D,C,G;ga("send","event","Video Browser",(E.videoId||E.embedCode)?"play":"redirect",B.data(c));Chorus.VideoContext.destroyAllPlayers();if(E.videoId){Chorus.VideoContext.createPlayer(i,E.videoId,{autoplay:true});return}if(E.embedCode){var F=g(E.embedCode);F.attr("width","100%").attr("height","100%").each(function(){var H=g(this);src=H.attr("src");src+=(src.indexOf("?")>-1)?"&":"?";src=src.replace(/autoplay=\d/g,"")+"autoplay=1&";src=src.replace(/ap=false/g,"")+"ap=true";src=src.replace(/width=\d+/g,"");src=src.replace(/height=\d+/g,"");H.css({"background-color":"#222"});H.attr("src",src)});g("#"+i).html(F).closest(d).addClass(o);return}setTimeout(function(){window.location.href=E.url},100)}function h(C){g(w).removeClass(p);C.addClass(p);var B=g(u);B.animate({scrollTop:B.scrollTop()+C.parent().position().top},{duration:500})}function v(B){var C={};if(B.data(j)){C.videoId=B.data(j)}if(B.data(r)){C.embedCode=B.data(r)}C.url=B.attr("href");return C}function n(E,C){function B(){E.siblings(".up")[(E.scrollTop()==0)?"removeClass":"addClass"]("is-active")}var D=E.scrollTop();if(C===true){D=D-E.height()}else{D=D+E.height()}E.animate({scrollTop:D},{duration:500,complete:B})}function e(B){B.preventDefault();z(v(g(B.currentTarget)))}function a(C){C.preventDefault();var B=g(C.currentTarget);h(B);z(v(B))}function b(B){B.preventDefault();g(B.currentTarget).siblings("a").trigger("click")}function y(B){B.stopPropagation();B.preventDefault();n(B.data.playlist,true)}function m(B){B.stopPropagation();B.preventDefault();n(B.data.playlist,false)}return{init:function(C){if(g(d).length<1){return}var B=g(f);B.on("click",l,e);B.on("click","h3",b);g(w).on("click",a);h(g(w+"[data-"+c+'="'+B.find(l).data(c)+'"]'));g(u).each(function(){var G=g(this);var F=G.find(A);var H=F.height();if(H*F.length>G.height()){var D=g('<div class="'+x+'"><span>&#xF500;</span></div>').on("click",{playlist:G},y);var E=g('<div class="'+q+'"><span>&#xF501;</span></div>').on("click",{playlist:G},m);G.after(D).after(E)}})}}})(jQuery);jQuery(SBN.VideoBrowser.init);var Chorus=Chorus||{};Chorus.DynamicSizedImages=function(d){var b={};d(document).ready(function(){Chorus.DynamicSizedImages.init()});var f=".vox-lazy-load";var a="lazy-loaded";var e="lazy-loading";function c(g,j){var h={failure_limit:20,load:function(){var p=d(this),n=p.parent(".image-window");if(p.is("img")){if(n.length>0){p.css({position:"absolute",top:Math.round((n.outerHeight()-p.outerHeight())/2),left:Math.round((n.outerWidth()-p.outerWidth())/2)});if(typeof p.attr("height")==="undefined"){p.css("height","auto")}}else{p.css("height","auto")}}p.addClass(a);p.removeClass(e);if(d.fn.playGIF){var o={};if(Chorus.Context&&Chorus.Context.main_link_color){o.circleBackgroundColor=Chorus.Context.main_link_color;o.circleTextColor="FFFFFF"}if(typeof PLAYGIF_DISABLE_FLAG==="undefined"){var m=d('.m-entry__body img[src*=".gif"], .m-block__fanshot-media img[src*=".gif"]');var q=d('.m-entry__top-hero .m-entry__photo img[data-original*=".gif"]');if((m.length+q.length)===1){PLAYGIF_DISABLE_FLAG=true}else{PLAYGIF_DISABLE_FLAG=false;m.playGIF(o)}}p.playGIF(o)}},threshold:800};if(j){d.extend(h,j)}var g=g||d("body");var i=g.find(f+":visible").not("."+e,"."+a);var l=[];i.each(function(u,o){var q=d(this);var r=q.data("imgkey");if(typeof r!=="undefined"){var m=q.outerWidth();var v=q.outerHeight();if(q.is("img")){var p=q.data("ratio"),s=q.parent(".image-window");if(typeof p!=="undefined"&&p>0){v=Math.ceil(m/p)}if(s.length>0){m=Math.ceil(s.outerWidth());v=Math.ceil(s.outerHeight())}if(v>0){q.css("height",v)}}if(typeof window.devicePixelRatio!=="undefined"){m=Math.ceil(m*window.devicePixelRatio);v=Math.ceil(v*window.devicePixelRatio)}var n=r+":"+m+"x"+v;l.push(n);q.attr("data-dim",m+"x"+v);q.addClass(e)}else{q.lazyload(h)}});if(l.length==0){return}l.sort(function(n,m){return +n.split(":")[0]-+m.split(":")[0]});d.ajax({type:"GET",url:"/chorus_page/optimally_sized_images",dataType:"json",contentType:"application/json",data:{imgkeys:l.join(",")},success:function(m){var n=m.urls;i.each(function(){var q=d(this);var p=q.data("imgkey")+":"+q.data("dim");var o=n[p];if(typeof o!=="undefined"){q.attr("data-original",o);q.lazyload(h)}})}})}b.init=function(){this.initUI();if(Chorus.EventDispatcher){Chorus.EventDispatcher.subscribe("moduleInserted",function(g){c(g.modules)})}};b.initUI=function(g,h){c(g,h)};b.applyTo=function(g,h){c(g,h)};return b}(jQuery);Chorus.ModuleLoader=(function(d){var b={};d(document).ready(function(){Chorus.ModuleLoader.init()});var a=function(e){d.ajax({type:"GET",url:"/chorus_page/delayed_load_cells",dataType:"json",contentType:"application/json",data:e,success:function(f){if(f===null){return}d.each(f,function(j,i){var h=d(d.parseHTML(i,document,true));var g=h.data("sbn-module-name");d("#"+j).replaceWith(h);if(Chorus.EventDispatcher){Chorus.EventDispatcher.publish("moduleInserted",{modules:h});if(g&&SBN[g]){SBN[g].init()}}})}})};var c=function(q){q=q||d(document);var h=[];var f=Util.UserAgentProfiler.profile();q.find("[data-delayed-load-cell-key]").each(function(){var i=d(this);if(i.data("unless-profile-is")!==f){h.push(i.data("delayed-load-cell-key"))}});if(h.length==0){return}h.sort();var g=2000,m=0,l=[];for(var j=0,o=h.length;j<o;j++){var p=h[j],e=p.length;if((m+e)>=g){var n={cells:JSON.stringify(l)};if(Chorus.Context.hub_id){n.hub_id=Chorus.Context.hub_id}a(n);l=[p];m=0}else{m+=e;l.push(p)}if((j+1)==o){var n={cells:JSON.stringify(l)};if(Chorus.Context.hub_id){n.hub_id=Chorus.Context.hub_id}a(n)}}};b.init=function(){this.initUI()};b.initUI=function(){c()};return b})(jQuery);var Chorus=Chorus||{};Chorus.EditoriallyManagedCell=(function(c,h){var g={edit:"/editorially_managed_cells/handle_edit",update:"/editorially_managed_cells/handle_update",preview:"/editorially_managed_cells/preview",show_live:"/editorially_managed_cells/refresh",help:"/editorially_managed_cells/help"};var d=null;function a(p){var q={};var m=p.serializeArray();for(var n=m.length-1;n>-1;n--){q[m[n].name]=m[n].value}return q}function e(m){alert("there was an error with the Editorially Managed Cell : "+m.statusText)}function b(m){m.preventDefault();var n=c(m.currentTarget);f(n.closest(".chorus-emc__admin"),n.data("emc-action"))}function i(n){n.preventDefault();var o=c(n.currentTarget);var m=o.closest("form");f(c('.chorus-emc__admin[data-emc-slug="'+m.data("emc-slug")+'"]'),"update",_.extend(a(m),{button_action:o.data("emc-action")}))}function f(m,o,q){var q=_.extend({slug:m.data("emc-slug"),bucket:m.data("emc-bucket")},q);var p=g[o];q;if(o==="edit"||o==="help"){Chorus.EventDispatcher.publish("modal_open",{method:n,url:p,data:q})}else{var n=(o=="update")?"POST":"GET";j(m);c.ajax({method:n,url:p,data:q,success:function(s){Chorus.EventDispatcher.publish("modal_close");var r=c('.chorus-emc__content[data-emc-slug="'+m.data("emc-slug")+'"]');if(r.length>0){r.replaceWith(s)}},error:e})}}function j(m){c(m).find(".chorus-emc__content").html("Loading...")}function l(){c(h).on("click",".chorus-emc__admin *[data-emc-action]",b);c(h).on("click",".chorus-emc__form *[data-emc-action]",i)}return{init:l,urls:g}})(jQuery,document);jQuery(function(){Chorus.EditoriallyManagedCell.init()});var SBN=SBN||{};SBN.SocialReferralPromos=(function(f){var a={facebook:"/sbn_modals/social_referral_promo/facebook","yahoo sports":"/sbn_modals/social_referral_promo/facebook",facebook_lookit:"/sbn_modals/social_referral_promo/facebook_lookit"};function g(){SBN.DataStore.set("social-referral-closed-"+Util.socialReferrer(),1);ga("send","event","Social Referral Promo","close",Util.socialReferrer(),{nonInteraction:true})}function i(){var j=Util.socialReferrer();if(j=="facebook"&&!Chorus.Context.communtiy_facebook_url){return null}if(window.location.pathname.indexOf("/lookit")==0){j=j+"_lookit"}return a[j]||null}function e(){f('*[data-modal-action="close"]').on("click",g);FB.XFBML.parse(document.getElementById("social-referral-fb-button"));FB.Event.subscribe("edge.create",function(j){if(/ref=social$/.test(j)){ga("send","event","Social Referral Promo","facebook like",undefined,{nonInteraction:true})}})}function d(){var j=i();if(j){Chorus.EventDispatcher.publish("modal_open",{url:modalUrl})}}function c(){clearTimeout(h);if(f(window).scrollTop()<300){h=setTimeout(c,1000)}else{d()}}var h;function b(){h=setTimeout(c,1000)}return{init:function(){if(Chorus.Context.community_domain!=="sbnation.com"||Util.isReferrerSocialDomain()===false||parseInt(SBN.DataStore.get("social-referral-closed-"+Util.socialReferrer()))===1){return}b()}}})(jQuery);jQuery(function(){SBN.SocialReferralPromos.init()});var SBN=SBN||{};SBN.EmcAdmin=(function(d){function c(h,f){var g=h.find("input");var e=f.find("input");g.each(function(i){var l=d(this);var j=d(e[i]);var m=j.val();j.val(l.val());l.val(m)})}function a(g){var e=d(g.currentTarget).closest("li");var f=e.prev("li");c(e,f)}function b(g){var f=d(g.currentTarget).closest("li");var e=f.next("li");c(f,e)}return{init:function(e){if(Chorus.Context.emc_admin==false){return}$doc=d(document);$doc.on("click",".m-emc-admin__reorderable-list .up",a);$doc.on("click",".m-emc-admin__reorderable-list .down",b)}}})(jQuery);jQuery(function(){SBN.EmcAdmin.init()});var SBN=SBN||{};SBN.ChannelBrowser=(function(g){var d=300,h=40,b;function c(){var i=b.width(),j=Math.floor((i-h)/(d+h));return{number:j,gutterWidth:j<=1?h:((i-h)-(j*d))/(j-1)}}function e(){console.log(c());var i=b.find(".m-channel-browser__ad");i.prevAll(".m-channel-browser__item").insertAfter(i);i.nextAll(".m-channel-browser__item:lt("+(c().number-1)+")").insertBefore(i)}function a(){var p=b.find(".m-channel-browser__item"),l=c(),r=l.number,s=l.gutterWidth-4,n=0;for(var m=0,o=p.length;m<o;m++){var q=(n===r-1);var j=s;if(q){j=0}if(r<=1){j=h}p.eq(m).css("margin-right",j);n=(q)?0:n+1}}function f(i){e();a()}return{init:function(){b=g(".m-channel-browser");if(b.length<1){return}e();a();g(window).on("resize",_.debounce(f,500))}}})(jQuery);jQuery(SBN.ChannelBrowser.init);SBN.ShareSelectionContextual=(function(d){var a=d(window);var f="";function h(){sel=window.getSelection();if(sel.rangeCount){range=sel.getRangeAt(0).cloneRange();if(range.getClientRects){var j=range.getClientRects();var l=j[j.length-1];if(l){return{x:l.right+a.scrollLeft()+5,y:l.top+a.scrollTop()+5}}}}return null}function c(l){var j=d(".m-share_selection_contextual");if(j.length<1){j=d('<div class="m-share_selection_contextual"><h3>Share your selection with your interweb friends</h3><ul><li class="p-button has-icon twitter"> Tweet ('+window.getSelection().toString().length+' char)<li class="p-button has-icon facebook">Share on Facebook</li></ul></div>')}j.css({top:l.y+"px",left:l.x+"px"});d("body").append(j)}function g(){d(".m-share_selection_contextual").remove()}function e(l){if(l==="facebook"){var n=Chorus.Context.short_url;if(!n){n=window.location.href}FB.ui({method:"feed",link:n,caption:f},function(q){})}if(l==="twitter"){var p="https://twitter.com/intent/tweet?text="+f;var o="scrollbars=yes,resizable=yes,toolbar=no,location=yes",m=550,j=420;if(Chorus.Context.short_url){p=p+"&url="+Chorus.Context.short_url}if(Chorus.Context.community_twitter_screen_name){p=p+"&via="+Chorus.Context.community_twitter_screen_name}window.open(p,"intent",o+",width="+m+",height="+j)}}function i(j){_.delay(function(){f=window.getSelection().toString();var l=h();if(f.length<1||l==null){g()}else{c(l)}},100)}function b(l){l.preventDefault();var m=d(l.currentTarget);var j=(m.hasClass("twitter"))?"twitter":(m.hasClass("facebook"))?"facebook":null;g();e(j);ga("send","event","Select To Social Contextual","service = "+j,undefined,{nonInteraction:true})}return{init:function(){if(window.getSelection&&Chorus.Context.select_to_tweet!==false){d(".m-entry__intro, .m-entry__body").on("mouseup",i);d("body").on("click",".m-share_selection_contextual li",b)}}}})(jQuery);jQuery(function(){SBN.ShareSelectionContextual.init()});var Chorus=Chorus||{};Chorus.UserMessaging=(function(f){var d;var l=Chorus.Context.network_slug==="polygon";var j=30000;var c=4000;function b(m){m.on("webkittransitionend transitionend otransitionEnd mstransitionend transitionend",function(){m.remove()});m.addClass("is-closed")}function i(m){m.preventDefault();m.stopPropagation();b(f(m.delegateTarget))}function g(){var m=f(".m-user-msg__notice");if(m.length>1){h()}m.first().find(".m-user-msg__close").trigger("click")}function h(){if(l===true){dur=(f(".m-user-msg__notice_short").length>0)?c:j;to=setTimeout(g,dur)}}function e(){f(".m-user-msg__notice, .m-user-msg__error").on("click",".m-user-msg__close",i)}function a(){f(".m-user-msg__modal").each(function(){Chorus.EventDispatcher.publish("modal_open",{content:f(this)})})}return{init:function(){if(f(".m-user-msg").length<1){return}a();e();h()}}})(jQuery);jQuery(Chorus.UserMessaging.init);var Chorus=Chorus||{};Chorus.Modal=(function(e){var u=null;var n,q,v;var f=[];var x=false;function p(){if(u!==null){return}var z=e(v());n.append(z);z.on("click",o);u=z.find(".m-chorus-modal__root").addBack(".m-chorus-modal__root").first()}function d(){p();n.addClass("chorus-modal-loading")}function y(){n.removeClass("chorus-modal-loading")}function b(){p();n.addClass("chorus-modal-open")}function c(){n.removeClass("chorus-modal-open")}function r(z){d();var A=z.data||{};z.success=function(B){z.content=B;l(z)};z.error=function(C,B){if(B!=="abort"){alert("There was an error recieving data from the server.")}y()};f.push(e.ajax(z))}function l(A){y();b();var z=e(q(A));z.find(".m-chorus-modal__window-root").append(A.content);z.data("chorus-modal-callbacks",A.callbacks);u.prepend(z);z.on("click","*[data-chorus-modal-action]",s);i("attach",z)}function w(z){z.remove();if(u.children().length===0){c();y()}}function g(z){z.callbacks=z.callbacks||{};z.title=z.title||"Untitled Modal";z.content=z.content||null;if(z.url){r(z)}else{if(z.content!==null){l(z)}}}function i(B,A){var z=A.data("chorus-modal-callbacks");if(B==="cancel_confirm"){if(confirm("Are you sure you want to close this window?")){B="cancel"}else{return}}if(B=="cancel"){w(A)}if(typeof(z[B])==="function"){z[B](A)}}function a(){e(".m-chorus-modal__window").each(function(){i("cancel",e(this))});if(u!==null){u.empty()}c();y();while(f.length>0){f.pop().abort()}}function j(){x=true;var z=e("#chorus-modal-window-template").html()||"";var A=e("#chorus-modal-wrapper-template").html()||"";n=e("body");q=_.template(z);v=_.template(A)}function s(z){z.preventDefault();i(e(z.target).data("chorus-modal-action").toString().trim(),e(z.delegateTarget))}function o(z){if(e(z.target).is(u)){a()}}function h(z){if(x===false){j()}g(z)}function m(z){a()}return{init:function(){Chorus.EventDispatcher.subscribe("modal_open",h);Chorus.EventDispatcher.subscribe("modal_close",m)},open:function(z){Chorus.EventDispatcher.publish("modal_open",z)},close:function(z){Chorus.EventDispatcher.publish("modal_close",z)}}})(jQuery);Chorus.Modal.init();shortcut={all_shortcuts:{},add:function(b,h,d){var g={type:"keydown",propagate:false,disable_in_input:false,target:document,keycode:false};if(!d){d=g}else{for(var a in g){if(typeof d[a]=="undefined"){d[a]=g[a]}}}var f=d.target;if(typeof d.target=="string"){f=document.getElementById(d.target)}var c=this;b=b.toLowerCase();var e=function(o){o=o||window.event;if(d.disable_in_input){var l;if(o.target){l=o.target}else{if(o.srcElement){l=o.srcElement}}if(l.nodeType==3){l=l.parentNode}if(l.tagName=="INPUT"||l.tagName=="TEXTAREA"){return}}if(o.keyCode){code=o.keyCode}else{if(o.which){code=o.which}}var n=String.fromCharCode(code).toLowerCase();if(code==188){n=","}if(code==190){n="."}var s=b.split("+");var r=0;var p={"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};var m={esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123};var q={shift:{wanted:false,pressed:false},ctrl:{wanted:false,pressed:false},alt:{wanted:false,pressed:false},meta:{wanted:false,pressed:false}};if(o.ctrlKey){q.ctrl.pressed=true}if(o.shiftKey){q.shift.pressed=true}if(o.altKey){q.alt.pressed=true}if(o.metaKey){q.meta.pressed=true}for(var j=0;k=s[j],j<s.length;j++){if(k=="ctrl"||k=="control"){r++;q.ctrl.wanted=true}else{if(k=="shift"){r++;q.shift.wanted=true}else{if(k=="alt"){r++;q.alt.wanted=true}else{if(k=="meta"){r++;q.meta.wanted=true}else{if(k.length>1){if(m[k]==code){r++}}else{if(d.keycode){if(d.keycode==code){r++}}else{if(n==k){r++}else{if(p[n]&&o.shiftKey){n=p[n];if(n==k){r++}}}}}}}}}}if(r==s.length&&q.ctrl.pressed==q.ctrl.wanted&&q.shift.pressed==q.shift.wanted&&q.alt.pressed==q.alt.wanted&&q.meta.pressed==q.meta.wanted){h(o);if(!d.propagate){o.cancelBubble=true;o.returnValue=false;if(o.stopPropagation){o.stopPropagation();o.preventDefault()}return false}}};this.all_shortcuts[b]={callback:e,target:f,event:d.type};if(f.addEventListener){f.addEventListener(d.type,e,false)}else{if(f.attachEvent){f.attachEvent("on"+d.type,e)}else{f["on"+d.type]=e}}},remove:function(a){a=a.toLowerCase();var d=this.all_shortcuts[a];delete (this.all_shortcuts[a]);if(!d){return}var b=d.event;var c=d.target;var e=d.callback;if(c.detachEvent){c.detachEvent("on"+b,e)}else{if(c.removeEventListener){c.removeEventListener(b,e,false)}else{c["on"+b]=false}}}};(function($){$.fn.markItUp=function(settings,extraSettings){var method,params,options,ctrlKey,shiftKey,altKey;ctrlKey=shiftKey=altKey=false;if(typeof settings=="string"){method=settings;params=extraSettings}options={id:"",nameSpace:"",root:"",previewHandler:false,previewInWindow:"",previewInElement:"",previewAutoRefresh:true,previewPosition:"after",previewTemplatePath:"~/templates/preview.html",previewParser:false,previewParserPath:"",previewParserVar:"data",resizeHandle:true,beforeInsert:"",afterInsert:"",onEnter:{},onShiftEnter:{},onCtrlEnter:{},onTab:{},markupSet:[{}]};$.extend(options,settings,extraSettings);if(!options.root){$("script").each(function(a,tag){miuScript=$(tag).get(0).src.match(/(.*)jquery\.markitup(\.pack)?\.js$/);if(miuScript!==null){options.root=miuScript[1]}})}var uaMatch=function(ua){ua=ua.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];return{browser:match[1]||"",version:match[2]||"0"}};var matched=uaMatch(navigator.userAgent);var browser={};if(matched.browser){browser[matched.browser]=true;browser.version=matched.version}if(browser.chrome){browser.webkit=true}else{if(browser.webkit){browser.safari=true}}return this.each(function(){var $$,textarea,levels,scrollPosition,caretPosition,caretOffset,clicked,hash,header,footer,previewWindow,template,iFrame,abort;$$=$(this);textarea=this;levels=[];abort=false;scrollPosition=caretPosition=0;caretOffset=-1;options.previewParserPath=localize(options.previewParserPath);options.previewTemplatePath=localize(options.previewTemplatePath);if(method){switch(method){case"remove":remove();break;case"insert":markup(params);break;default:$.error("Method "+method+" does not exist on jQuery.markItUp")}return}function localize(data,inText){if(inText){return data.replace(/("|')~\//g,"$1"+options.root)}return data.replace(/^~\//,options.root)}function init(){id="";nameSpace="";if(options.id){id='id="'+options.id+'"'}else{if($$.attr("id")){id='id="markItUp'+($$.attr("id").substr(0,1).toUpperCase())+($$.attr("id").substr(1))+'"'}}if(options.nameSpace){nameSpace='class="'+options.nameSpace+'"'}$$.wrap("<div "+nameSpace+"></div>");$$.wrap("<div "+id+' class="markItUp"></div>');$$.wrap('<div class="markItUpContainer"></div>');$$.addClass("markItUpEditor");header=$('<div class="markItUpHeader"></div>').insertBefore($$);$(dropMenus(options.markupSet)).appendTo(header);footer=$('<div class="markItUpFooter"></div>').insertAfter($$);if(options.resizeHandle===true&&browser.safari!==true){resizeHandle=$('<div class="markItUpResizeHandle"></div>').insertAfter($$).bind("mousedown.markItUp",function(e){var h=$$.height(),y=e.clientY,mouseMove,mouseUp;mouseMove=function(e){$$.css("height",Math.max(20,e.clientY+h-y)+"px");return false};mouseUp=function(e){$("html").unbind("mousemove.markItUp",mouseMove).unbind("mouseup.markItUp",mouseUp);return false};$("html").bind("mousemove.markItUp",mouseMove).bind("mouseup.markItUp",mouseUp)});footer.append(resizeHandle)}$$.bind("keydown.markItUp",keyPressed).bind("keyup",keyPressed);$$.bind("insertion.markItUp",function(e,settings){if(settings.target!==false){get()}if(textarea===$.markItUp.focused){markup(settings)}});$$.bind("focus.markItUp",function(){$.markItUp.focused=this});if(options.previewInElement){refreshPreview()}}function dropMenus(markupSet){var ul=$("<ul></ul>"),i=0;$("li:hover > ul",ul).css("display","block");$.each(markupSet,function(){var button=this,t="",title,li,j;title=(button.key)?(button.name||"")+" [Ctrl+"+button.key+"]":(button.name||"");key=(button.key)?'accesskey="'+button.key+'"':"";if(button.separator){li=$('<li class="markItUpSeparator">'+(button.separator||"")+"</li>").appendTo(ul)}else{i++;for(j=levels.length-1;j>=0;j--){t+=levels[j]+"-"}li=$('<li class="markItUpButton markItUpButton'+t+(i)+" "+(button.className||"")+'"><a href="" '+key+' title="'+title+'">'+(button.name||"")+"</a></li>").bind("contextmenu.markItUp",function(){return false}).bind("click.markItUp",function(e){e.preventDefault()}).bind("focusin.markItUp",function(){$$.focus()}).bind("mouseup",function(){if(button.call){eval(button.call)()}markup(button);return false}).bind("mouseenter.markItUp",function(){$("> ul",this).show();$(document).one("click",function(){$("ul ul",header).hide()})}).bind("mouseleave.markItUp",function(){$("> ul",this).hide()}).appendTo(ul);if(button.dropMenu){levels.push(i);$(li).addClass("markItUpDropMenu").append(dropMenus(button.dropMenu))}}});levels.pop();return ul}function magicMarkups(string){if(string){string=string.toString();string=string.replace(/\(\!\(([\s\S]*?)\)\!\)/g,function(x,a){var b=a.split("|!|");if(altKey===true){return(b[1]!==undefined)?b[1]:b[0]}else{return(b[1]===undefined)?"":b[0]}});string=string.replace(/\[\!\[([\s\S]*?)\]\!\]/g,function(x,a){var b=a.split(":!:");if(abort===true){return false}value=prompt(b[0],(b[1])?b[1]:"");if(value===null){abort=true}return value});return string}return""}function prepare(action){if($.isFunction(action)){action=action(hash)}return magicMarkups(action)}function build(string){var openWith=prepare(clicked.openWith);var placeHolder=prepare(clicked.placeHolder);var replaceWith=prepare(clicked.replaceWith);var closeWith=prepare(clicked.closeWith);var openBlockWith=prepare(clicked.openBlockWith);var closeBlockWith=prepare(clicked.closeBlockWith);var multiline=clicked.multiline;if(replaceWith!==""){block=openWith+replaceWith+closeWith}else{if(selection===""&&placeHolder!==""){block=openWith+placeHolder+closeWith}else{string=string||selection;var lines=[string],blocks=[];if(multiline===true){lines=string.split(/\r?\n/)}for(var l=0;l<lines.length;l++){line=lines[l];var trailingSpaces;if(trailingSpaces=line.match(/ *$/)){blocks.push(openWith+line.replace(/ *$/g,"")+closeWith+trailingSpaces)}else{blocks.push(openWith+line+closeWith)}}block=blocks.join("\n")}}block=openBlockWith+block+closeBlockWith;return{block:block,openBlockWith:openBlockWith,openWith:openWith,replaceWith:replaceWith,placeHolder:placeHolder,closeWith:closeWith,closeBlockWith:closeBlockWith}}function markup(button){var len,j,n,i;hash=clicked=button;get();$.extend(hash,{line:"",root:options.root,textarea:textarea,selection:(selection||""),caretPosition:caretPosition,ctrlKey:ctrlKey,shiftKey:shiftKey,altKey:altKey});prepare(options.beforeInsert);prepare(clicked.beforeInsert);if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.beforeMultiInsert)}$.extend(hash,{line:1});if((ctrlKey===true&&shiftKey===true)){lines=selection.split(/\r?\n/);for(j=0,n=lines.length,i=0;i<n;i++){if($.trim(lines[i])!==""){$.extend(hash,{line:++j,selection:lines[i]});lines[i]=build(lines[i]).block}else{lines[i]=""}}string={block:lines.join("\n")};start=caretPosition;len=string.block.length+((browser.opera)?n-1:0)}else{if(ctrlKey===true){string=build(selection);start=caretPosition+string.openWith.length;len=string.block.length-string.openWith.length-string.closeWith.length;len=len-(string.block.match(/ $/)?1:0);len-=fixIeBug(string.block)}else{if(shiftKey===true){string=build(selection);start=caretPosition;len=string.block.length;len-=fixIeBug(string.block)}else{string=build(selection);start=caretPosition+string.block.length;len=0;start-=fixIeBug(string.block)}}}if((selection===""&&string.replaceWith==="")){caretOffset+=fixOperaBug(string.block);start=caretPosition+string.openBlockWith.length+string.openWith.length;len=string.block.length-string.openBlockWith.length-string.openWith.length-string.closeWith.length-string.closeBlockWith.length;caretOffset=$$.val().substring(caretPosition,$$.val().length).length;caretOffset-=fixOperaBug($$.val().substring(0,caretPosition))}$.extend(hash,{caretPosition:caretPosition,scrollPosition:scrollPosition});if(string.block!==selection&&abort===false){insert(string.block);set(start,len)}else{caretOffset=-1}get();$.extend(hash,{line:"",selection:selection});if((ctrlKey===true&&shiftKey===true)||button.multiline===true){prepare(clicked.afterMultiInsert)}prepare(clicked.afterInsert);prepare(options.afterInsert);if(previewWindow&&options.previewAutoRefresh){refreshPreview()}shiftKey=altKey=ctrlKey=abort=false}function fixOperaBug(string){if(browser.opera){return string.length-string.replace(/\n*/g,"").length}return 0}function fixIeBug(string){if(browser.msie){return string.length-string.replace(/\r*/g,"").length}return 0}function insert(block){if(document.selection){var newSelection=document.selection.createRange();newSelection.text=block}else{textarea.value=textarea.value.substring(0,caretPosition)+block+textarea.value.substring(caretPosition+selection.length,textarea.value.length)}}function set(start,len){if(textarea.createTextRange){if(browser.opera&&browser.version>=9.5&&len==0){return false}range=textarea.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",len);range.select()}else{if(textarea.setSelectionRange){textarea.setSelectionRange(start,start+len)}}textarea.scrollTop=scrollPosition;textarea.focus()}function get(){textarea.focus();scrollPosition=textarea.scrollTop;if(document.selection){selection=document.selection.createRange().text;if(browser.msie){var range=document.selection.createRange(),rangeCopy=range.duplicate();rangeCopy.moveToElementText(textarea);caretPosition=-1;while(rangeCopy.inRange(range)){rangeCopy.moveStart("character");caretPosition++}}else{caretPosition=textarea.selectionStart}}else{caretPosition=textarea.selectionStart;selection=textarea.value.substring(caretPosition,textarea.selectionEnd)}return selection}function preview(){if(typeof options.previewHandler==="function"){previewWindow=true}else{if(options.previewInElement){previewWindow=$(options.previewInElement)}else{if(!previewWindow||previewWindow.closed){if(options.previewInWindow){previewWindow=window.open("","preview",options.previewInWindow);$(window).unload(function(){previewWindow.close()})}else{iFrame=$('<iframe class="markItUpPreviewFrame"></iframe>');if(options.previewPosition=="after"){iFrame.insertAfter(footer)}else{iFrame.insertBefore(header)}previewWindow=iFrame[iFrame.length-1].contentWindow||frame[iFrame.length-1]}}else{if(altKey===true){if(iFrame){iFrame.remove()}else{previewWindow.close()}previewWindow=iFrame=false}}}}if(!options.previewAutoRefresh){refreshPreview()}if(options.previewInWindow){previewWindow.focus()}}function refreshPreview(){renderPreview()}function renderPreview(){var phtml;if(options.previewHandler&&typeof options.previewHandler==="function"){options.previewHandler($$.val())}else{if(options.previewParser&&typeof options.previewParser==="function"){var data=options.previewParser($$.val());writeInPreview(localize(data,1))}else{if(options.previewParserPath!==""){$.ajax({type:"POST",dataType:"text",global:false,url:options.previewParserPath,data:options.previewParserVar+"="+encodeURIComponent($$.val()),success:function(data){writeInPreview(localize(data,1))}})}else{if(!template){$.ajax({url:options.previewTemplatePath,dataType:"text",global:false,success:function(data){writeInPreview(localize(data,1).replace(/<!-- content -->/g,$$.val()))}})}}}}return false}function writeInPreview(data){if(options.previewInElement){$(options.previewInElement).html(data)}else{if(previewWindow&&previewWindow.document){try{sp=previewWindow.document.documentElement.scrollTop}catch(e){sp=0}previewWindow.document.open();previewWindow.document.write(data);previewWindow.document.close();previewWindow.document.documentElement.scrollTop=sp}}}function keyPressed(e){shiftKey=e.shiftKey;altKey=e.altKey;ctrlKey=(!(e.altKey&&e.ctrlKey))?(e.ctrlKey||e.metaKey):false;if(e.type==="keydown"){if(ctrlKey===true){li=$('a[accesskey="'+((e.keyCode==13)?"\\n":String.fromCharCode(e.keyCode))+'"]',header).parent("li");if(li.length!==0){ctrlKey=false;li.triggerHandler("mouseup");return false}}if(e.keyCode===13||e.keyCode===10){if(ctrlKey===true){ctrlKey=false;markup(options.onCtrlEnter);return options.onCtrlEnter.keepDefault}else{if(shiftKey===true){shiftKey=false;markup(options.onShiftEnter);return options.onShiftEnter.keepDefault}else{markup(options.onEnter);return options.onEnter.keepDefault}}}if(e.keyCode===9){if(shiftKey==true||ctrlKey==true||altKey==true){return false}if(caretOffset!==-1){get();caretOffset=$$.val().length-caretOffset;set(caretOffset,0);caretOffset=-1;return false}else{markup(options.onTab);return options.onTab.keepDefault}}}}function remove(){$$.unbind(".markItUp").removeClass("markItUpEditor");$$.parent("div").parent("div.markItUp").parent("div").replaceWith($$);$$.data("markItUp",null)}init()})};$.fn.markItUpRemove=function(){return this.each(function(){$(this).markItUp("remove")})};$.markItUp=function(settings){var options={target:false};$.extend(options,settings);if(options.target){return $(options.target).each(function(){$(this).focus();$(this).trigger("insertion",[options])})}else{$("textarea").trigger("insertion",[options])}}})(jQuery);window.Chorus||(Chorus={});Chorus.Comments=_.extend({},Backbone.Events,{Collections:{},Models:{},Views:{},Mixins:{},autoUpdateTimeout:null,defaults:{ajaxParams:{},ajaxTimeout:15000,alertErrors:true,avatarBreakpointIndex:2,autoUpdateAlertMaxShown:5,autoUpdateAlertTimeShown:6500,autoUpdateEnabled:false,buildAncestry:true,currentAutoUpdateInterval:20000,editTimeWindow:90,emptyUpdateTolerance:5,fastAutoUpdateInterval:20000,flaggedThreshold:1,localClockOffset:null,markItUp:{onShiftEnter:{keepDefault:false,replaceWith:"\n\n"},markupSet:[{name:"Bold",key:"B",closeWith:"*",openWith:"*"},{name:"Italic",key:"I",closeWith:"_",openWith:"_"},{name:"Strike through",key:"S",closeWith:"-",openWith:"-"},{name:"Spoilers",key:"F",openWith:"%(spoiler)",closeWith:"%"},{separator:"---------------"},{name:"Bulleted list",openWith:"* ",multiline:true},{name:"Numeric list",openWith:"# ",multiline:true},{separator:"---------------"},{name:"Picture",openWith:"![![Source:!:http://]!](",closeWith:")!"},{name:"Link",openWith:'"',closeWith:'(!(([![Title (Shown on hover)]!]))!)":[![Link:!:http://]!]',placeHolder:"Your text to link here..."},{separator:"---------------"},{name:"Quotes",openWith:"bq. "}],resizeHandle:false},maxIndentationDepth:30,offsetHeight:Math.floor(jQuery(window).height()*0.333),recommendedThreshold:1,renderChunkLength:200,renderTo:"#comments",scrollAnimationDuration:300,scrollBuffer:0,showAutoUpdateAlert:true,showAvatars:true,showSignatures:true,showImages:true,slowAutoUpdateInterval:60000,sortMethod:"ancestry",startOnScroll:(Chorus.Environment.currentBreakpoint().index>1)},settings:{},initialize:function(b,a){this.stop();this.started=false;this.context={};this.settings=_.extend({},this.defaults,this.settings,a);this.collection=new Chorus.Comments.Collections.Comments([],{entryId:b});if(this.settings.renderTo){this.compileTemplates();this.view=new Chorus.Comments.Views.Main({el:this.settings.renderTo,collection:this.collection});this.view.render()}if(window.location.hash.match(/^#\d+$/)){this.start()}return this},initContext:function(a){this.context=a;this.settings.autoUpdateEnabled=this.settings.autoUpdateEnabled&&this.context.able_to_comment&&!this.context.comments_closed&&Chorus.Environment.currentBreakpoint().index>1;if(this.settings.autoUpdateEnabled){this.startAutoUpdate()}},start:function(){if(this.started){return}this.started=true;this.listenTo(this,"ajaxSuccess",this.ajaxSuccess);this.listenTo(this,"ajaxError",this.ajaxError);this.collection.load();this.trigger("start");return this},stop:function(){if(this.view){this.view.remove()}this.view=null;this.collection=null;this.started=false;this.trigger("stop");this.stopListening();return this},compileTemplates:function(){_.each(Chorus.Comments.Views,function(b){if(b.prototype.templateId){var a=jQuery("#"+b.prototype.templateId).html()||"";b.prototype.template=_.template(a)}})},scheduleAutoUpdate:function(b){if(!this.settings.autoUpdateEnabled){return}var a;if(b.emptyUpdateCount<this.settings.emptyUpdateTolerance){a=this.settings.fastAutoUpdateInterval}else{a=this.settings.slowAutoUpdateInterval}this.settings.currentAutoUpdateInterval=a;clearTimeout(this.autoUpdateTimeout);this.autoUpdateTimeout=setTimeout(function(){b.update()},a)},startAutoUpdate:function(){this.settings.autoUpdateEnabled=true;this.listenTo(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate);this.scheduleAutoUpdate(this.collection)},stopAutoUpdate:function(){this.settings.autoUpdateEnabled=false;this.stopListening(this.collection,"updateSuccess updateError",this.scheduleAutoUpdate);clearTimeout(this.autoUpdateTimeout);this.autoUpdateTimeout=null},openModal:function(a){Chorus.EventDispatcher.publish("modal_open",{content:a})},closeModal:function(){Chorus.EventDispatcher.publish("modal_close")},ajaxSuccess:function(b,a,g,c){var d=Date.parse(g.getResponseHeader("Date"));var f=(new Date().valueOf()-d.valueOf())/1000;var e=this.settings.localClockOffset;if(_.isNumber(e)){this.settings.localClockOffset=(e+f)/2}else{this.settings.localClockOffset=f}},ajaxError:function(f,a,e,d){try{var b=JSON.parse(f.responseText);if(b.message&&this.settings.alertErrors){alert(b.message)}}catch(c){}}});Chorus.Comments.Mixins.Ajax={urlFor:function(b){var a=this.urls[b];if(a){a=a.replace(/:([^\/]+)/,_.bind(function(d,c){return(this instanceof Backbone.Model)?this.get(c):this[c]},this))}return a},ajax:function(e,b){var a=this.urlFor(e);if(!a){throw"ArgumentError: No url specified for action: "+e}var d=this;var c=_.extend({url:a,dataType:"json",context:this,timeout:Chorus.Comments.settings.ajaxTimeout},this.ajaxOptions||{},b);if(c.data&&_.isObject(c.data)&&c.type==="POST"){c.contentType="application/json";c.data=JSON.stringify(c.data);c.processData=false}c.error=function(h,f,g){if(b&&_.isFunction(b.error)){b.error.call(c.context,d,g)}d.trigger(e+"Error",d,g,h);Chorus.Comments.trigger("ajaxError",h,f,g,d)};c.success=function(g,f,h){if(b&&_.isFunction(b.success)){b.success.call(c.context,d,g)}d.trigger(e+"Success",d,g,h);Chorus.Comments.trigger("ajaxSuccess",g,f,h,d)};d.trigger(e+"Start",d);Chorus.Comments.trigger("ajaxStart",d);return jQuery.ajax(c)}};Chorus.Comments.Models.Comment=Backbone.Model.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{ajaxOptions:{type:"POST"},urls:{preview:"/comments/preview_comment",post:"/comments/post_comment",edit:"/comments/edit_comment/:id",hide:"/comments/hide_comment/:id",flag:"/comments/flag_comment/:id",unflag:"/comments/unflag_comment/:id",recommend:"/comments/recommend_comment/:id",destroy:"/comments/destroy_comment/:id",loadFlaggings:"/comments/ajax_comment_flags/:id",blockUser:"/comments/block_user/:id"},initialize:function(){if(Chorus.Comments.settings.buildAncestry&&(!this.get("ancestry")||!this.get("depth"))){this.buildAncestry()}this.listenTo(this,"change:id change:parent_id",this.buildAncestry);this.listenTo(this,"change:collapsed",this.collapseDescendants)},buildAncestry:function(){var c=function(e){e=e.toString();return e.length>=10?e:new Array(10-e.length+1).join("0")+e};var a=this.id?c(this.id):"preview";var b=this.parent();var d;if(b){a=b.get("ancestry")+"/"+a}d=a.split("/").length;d=Math.min(d,Chorus.Comments.settings.maxIndentationDepth);this.set({ancestry:a,depth:d},{silent:true})},user:function(){return this.collection.users.get(this.get("user_id"))||new Chorus.Comments.Models.User({display_name:"anonymous"})},parent:function(){var a=this.get("parent_id");if(a){return this.collection.get(a)}else{return null}},ancestors:function(){if(!this.get("ancestry")){return[]}var a=this.get("ancestry").split("/");a.pop();return _.map(a,function(b){b=parseInt(b,10);return this.collection.get(b)},this)},descendants:function(){var a=new RegExp("^"+this.get("ancestry")+"/");return this.collection.filter(function(b){return a.test(b.get("ancestry"))})},matchesConditions:function(b){for(var a in b){if(b[a]!=this.get(a)){return false}}return true},findNeighbor:function(f,e,b){var g=this.collection.indexOf(this);var a=this.collection.length-1;var c=g;var d;if(a===0){return null}do{c=(b)?c-1:c+1;if(!e&&(c<0||c>a)){return null}else{if(c<0){c=a}else{if(c>a){c=0}}}d=this.collection.at(c);if(d&&d.matchesConditions(f)){return d}}while(c!==g);return null},prev:function(b,a){return this.findNeighbor(b,a,true)},next:function(b,a){return this.findNeighbor(b,a,false)},flaggings:function(){return this.collection.flaggings.where({flaggable_id:this.id})},isFlagged:function(){return this.get("bad_flags_count")>=Chorus.Comments.settings.flaggedThreshold},isRecommended:function(){return this.get("recommended_flags_count")>=Chorus.Comments.settings.recommendedThreshold},createFlagging:function(a){return this.collection.flaggings.add({flag_name:a,flaggable_id:this.id,user_id:Chorus.Comments.context.user_id,created_on:new Date()})},secondsSinceCreate:function(){var b=Chorus.Comments.settings.localClockOffset||0;var a=new Date().getTime()/1000;a=Math.round(a-b);return a-this.get("created_on_timestamp")},isEditable:function(){return this.get("user_id")===Chorus.Comments.context.user_id&&this.secondsSinceCreate()<Chorus.Comments.settings.editTimeWindow},isPreview:function(){return !this.id},toJSON:function(){var b=_.clone(this.attributes);var a;b.is_flagged=this.isFlagged();b.is_recommended=this.isRecommended();b.is_editable=this.isEditable();b.is_preview=this.isPreview();b.permalink=this.getAbsoluteURL("permalink");b.shortlink=this.getAbsoluteURL("shortlink");if(Chorus.Environment.currentBreakpoint().index<2){b.created_on=this.get("created_on_short")}else{b.created_on=this.get("created_on_long")}a=this.user();if(a){b.user=a.toJSON(true)}return b},getAbsoluteURL:function(a){return window.location.origin+this.get(a)},preview:function(){return this.ajax("preview",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(b,a){b.collection.users.add(a,{parse:true});b.set(a.comments[0])}})},post:function(){var a=this.get("body");if(a){this.set("rawBody",a)}return this.ajax("post",{data:{entry_id:this.collection.entryId,comment:_.pick(this.attributes,"user_id","parent_id","title","body")},success:function(c,b){c.collection.users.add(b,{parse:true});c.set(b.comments[0]);c.collection.add(c)}})},edit:function(a){if(a.body){this.set("rawBody",a.body)}return this.ajax("edit",{data:{entry_id:this.collection.entryId,comment:a},success:function(c,b){c.set(b.comments[0])}})},hide:function(){var a={};var b=this.descendants();_.each(b,function(c){a[c.id]=c.get("hidden");c.set("hidden",true)});this.set("hidden",true);return this.ajax("hide",{error:function(c){c.set("hidden",false);_.each(b,function(d){d.set("hidden",a[d.id])})}})},unhide:function(){this.set("hidden",false);return this.ajax("hide",{error:function(a){a.set("hidden",true)}})},flag:function(b){var a=this.createFlagging("inappropriate");this.set({is_flagged_by_user:true,bad_flags_count:this.get("bad_flags_count")+1});return this.ajax("flag",{data:b,error:function(c){c.set({is_flagged_by_user:false,bad_flags_count:c.get("bad_flags_count")-1});c.collection.flaggings.remove(a)}})},unflag:function(){var a=this.flaggingsLoaded;var b=this.flaggings();this.flaggingsLoaded=false;this.collection.flaggings.remove(b);this.set({is_flagged_by_user:false,bad_flags_count:this.get("bad_flags_count")-1});return this.ajax("unflag",{error:function(c){c.set({is_flagged_by_user:true,bad_flags_count:c.get("bad_flags_count")+1});c.collection.flaggings.add(b);c.flaggingsLoaded=a}})},recommend:function(){var a=this.createFlagging("recommended");this.set({is_recommended_by_user:true,recommended_flags_count:(this.get("recommended_flags_count")||0)+1});return this.ajax("recommend",{error:function(b){b.set({is_recommended_by_user:false,recommended_flags_count:b.get("recommended_flags_count")-1});b.collection.flaggings.remove(a)}})},unrecommend:function(){var a=this.flaggings();this.collection.flaggings.remove(a);this.set({is_recommended_by_user:false,recommended_flags_count:this.get("recommended_flags_count")-1});return this.ajax("unflag",{error:function(b){b.set({is_recommended_by_user:true,recommended_flags_count:b.get("recommended_flags_count")+1});b.collection.flaggings.add(a)}})},destroy:function(){var a=this.collection;var b=this.descendants();a.remove(b);a.remove(this);return this.ajax("destroy",{error:function(c){a.add(c);a.add(b)}})},loadFlaggings:function(){return this.ajax("loadFlaggings",{type:"GET",success:function(b,a){b.collection.users.add(a,{parse:true,merge:true});b.collection.flaggings.add(a,{parse:true,merge:true});b.flaggingsLoaded=true}})},collapseDescendants:function(a,b){if(b){_.each(this.descendants(),function(d){if(!d.get("collapsedAncestorId")){d.set("collapsedAncestorId",this.id)}},this)}else{_.each(this.descendants(),function(d){if(d.get("collapsedAncestorId")===this.id){d.set("collapsedAncestorId",null)}},this)}},blockUser:function(){var a=this.user();var c=this.collection;var b=c.where({user_id:this.get("user_id")});c.remove(b);c.users.remove(a);return this.ajax("blockUser",{error:function(){c.users.add(a);c.add(b)}})}}));Chorus.Comments.Models.Flagging=Backbone.Model.extend({initialize:function(){this.set("created_on_timestamp",Math.round(new Date(this.get("created_on")).getTime()/1000))},user:function(){return this.collection.users.get(this.get("user_id"))},flaggable:function(){return this.collection.comments.get(this.get("flaggable_id"))},toJSON:function(){var c=_.clone(this.attributes);var a=this.user();var b=new Date(this.get("created_on")).toLocaleString();c.created_on=b;if(a){c.user=a.toJSON()}return c}});Chorus.Comments.Models.User=Backbone.Model.extend({initialize:function(){var a=this.get("author_profile");var b=this.get("network_membership");if(a){this.set({profile_image:this.get("author_profile").image_url,profile_url:this.get("author_profile").url})}else{if(b){this.set({profile_image:b.image_url,profile_url:b.url})}}},isAuthor:function(){return Chorus.Comments.context.author_id===this.id},isContributor:function(){return _.indexOf(Chorus.Comments.context.contributor_ids,this.id)>-1},toJSON:function(){var a=_.clone(this.attributes);a.is_author=this.isAuthor();a.is_contributor=this.isContributor();return a}});Chorus.Comments.Collections.Comments=Backbone.Collection.extend(_.extend({},Chorus.Comments.Mixins.Ajax,{model:Chorus.Comments.Models.Comment,urls:{load:"/comments/load_comments/:entryId",update:"/comments/ajax_comments_update/:entryId"},loaded:false,lastRequestId:0,emptyUpdateCount:0,initialize:function(b,a){this.entryId=a.entryId;this.users=new Chorus.Comments.Collections.Users();this.flaggings=new Chorus.Comments.Collections.Flaggings([],{users:this.users,comments:this});this.listenTo(this,"add",this.findCollapsedAncestor);return this},comparator:function(e,c){switch(Chorus.Comments.settings.sortMethod){case"ancestry":var f=e.get("ancestry");var d=c.get("ancestry");if(f<d){return -1}else{if(f>d){return 1}else{return 0}}case"forward-chron":if(e.get("created_on_timestamp")===c.get("created_on_timestamp")){return e.get("id")-c.get("id")}else{return e.get("created_on_timestamp")-c.get("created_on_timestamp")}case"reverse-chron":if(e.get("created_on_timestamp")===c.get("created_on_timestamp")){return c.get("id")-e.get("id")}else{return c.get("created_on_timestamp")-e.get("created_on_timestamp")}}},parse:function(a){return a.comments||[]},load:function(){return this.ajax("load",{timeout:null,data:_.extend({t:new Date().getTime()},Chorus.Comments.settings.ajaxParams),success:function(b,a){Chorus.Comments.initContext(a.context);b.loaded=true;b.lastId=a.last_id;b.lastVersion=a.last_version;b.users.reset(a,{parse:true});b.flaggings.reset(a,{parse:true});b.reset(a,{parse:true})}})},update:function(){this.lastRequestId+=1;return this.ajax("update",{data:_.extend({request_id:this.lastRequestId,last_id:this.lastId,last_version:this.lastVersion},Chorus.Comments.settings.ajaxParams),success:function(b,a){if(b.lastRequestId!==a.last_request_id){console.warn("Failed to update comments: updates arrived out of order");return}b.lastId=a.last_id;b.lastVersion=a.last_version;if(a.comments.length){b.emptyUpdateCount=0}else{b.emptyUpdateCount++}_.each(a.deleted_comment_ids,function(d){var c=b.get(d);if(c){b.remove(c.descendants());b.remove(c)}});b.users.add(a,{parse:true});b.add(a,{parse:true});b.flaggings.add(a,{parse:true})},error:function(b,a){b.emptyUpdateCount++}})},findCollapsedAncestor:function(b){var a=_.find(b.ancestors().reverse(),function(d){return d.get("collapsed")});if(a){b.set("collapsedAncestorId",a.id);a.trigger("change")}}}));Chorus.Comments.Collections.Flaggings=Backbone.Collection.extend({model:Chorus.Comments.Models.Flagging,initialize:function(b,a){this.users=a.users;this.comments=a.comments},parse:function(a){return a.flaggings||[]}});Chorus.Comments.Collections.Users=Backbone.Collection.extend({model:Chorus.Comments.Models.User,parse:function(b,a){return b.users||[]},current:function(){return this.get(Chorus.Comments.context.user_id)}});Chorus.Comments.Views.AccountActions=Backbone.View.extend({id:"",className:"",templateId:"comment-account-actions-template",render:function(){this.$el.html(this.template());this.trigger("render",this);return this}});Chorus.Comments.Views.AutoUpdateAlert=Backbone.View.extend({id:"autoupdate_info",templateId:"comment-auto-update-alert-template",events:{"click .close":"hide","click .go_to_comment":"goToComment"},initialize:function(a){this.listenTo(this.collection,"updateSuccess",this.show)},render:function(){this.$el.hide();this.trigger("render",this);return this},show:function(d,a){if(Chorus.Comments.settings.showAutoUpdateAlert===false){return}var c=[];_.each(a.comments,function(h){if(h.user_id!==Chorus.Comments.context.user_id){var e=d.get(h.id);var f=e.toJSON();var g=e.parent();if(g){f.parent=g.toJSON()}c.push(f)}});if(c.length===0){return}var b=this.template({comments:c,settings:Chorus.Comments.settings});this.$el.html(b).fadeIn(1000);setTimeout(_.bind(this.hide,this),Chorus.Comments.settings.autoUpdateAlertTimeShown)},hide:function(){this.$el.fadeOut(500);return false},goToComment:function(a){var b=a.currentTarget.getAttribute("data-comment-id");Chorus.Comments.trigger("activateComment",b);return false}});Chorus.Comments.Views.BaseForm=Backbone.View.extend({events:{"submit form":"submit","click .post_comment_button":"post","click .preview_comment_button":"preview","click .cancel_comment_button":"cancel"},renderPreview:function(a){if(this.previewView){this.previewView.model=a}else{this.previewView=new Chorus.Comments.Views.Comment({model:a})}this.previewView.render().$el.prependTo(this.el);this.$(".preview-controls").show();this.$(".preview_comment_button").prop("disabled",false).val("Preview");return this},formData:function(){var a=this.$("form").serializeArray();var b={};_.each(a,function(c){b[c.name]=c.value});return b},submit:function(){if(this.previewView){this.post()}else{this.preview()}return false},post:function(){var b=this.$(".post_comment_button");b.prop("disabled",true).val(this.submitText+"ing...");var a=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});a.once("postSuccess",function(){this.cancel()},this);a.once("postError",function(){b.prop("disabled",false).val(this.submitText)},this);a.post();return false},preview:function(){var b=this.$(".preview_comment_button");b.prop("disabled",true).val("Previewing...");var a=new Chorus.Comments.Models.Comment(this.formData(),{collection:this.collection});a.once("previewSuccess",this.renderPreview,this);a.once("previewError",function(){b.prop("disabled",false).val("Preview")},this);a.preview();return false},remove:function(){if(this.previewView){this.previewView.remove();this.previewView=null}return Backbone.View.prototype.remove.call(this)}});Chorus.Comments.Views.Comment=Backbone.View.extend({templateId:"comment-template",events:{"click .reply_link":"reply","click .edit_link":"edit","click .flag_link":"toggleFlagged","click .rec_link":"toggleRecommended","click .delete_link":"destroy","click .hide_link":"toggleHidden","click .up_link":"activateParent","click .actions_toggle":"toggleActions","click .inspect_flags_link":"inspectFlags","click .collapse_toggle":"toggleCollapsed","click .image_toggle .message":"toggleImage"},renderTriggers:["id","parent_id","title","body","user_id","signature","hidden","created_on_long","created_on_short","created_on_timestamp","recommended_flags_count","is_recommended_by_user","troll_flags_count","spam_flags_count","inappropriate_flags_count","bad_flags_count","is_flagged_by_user"],initialize:function(){this.listenTo(this.model,"change:"+this.renderTriggers.join(" change:"),this.render);this.listenTo(this.model,"change",this.regenerateWrapperClass);this.listenTo(this.model,"markRead",this.markCollapsedDescendantsRead);this.listenTo(this.model,"remove",this.remove);return this},className:function(){var d=this.model.toJSON();var c=Chorus.Comments.context;var b=[];var a=function(f,e){if(e){b.push(f)}else{b=_.without(b,f)}};if(this.el&&this.el.className){b=b.concat(this.el.className.split(" "))}a("citem",true);a("cdepth-"+d.depth,true);a("recommended",d.is_recommended);a("flagged",c.able_to_moderate&&d.is_flagged);a("new",d.is_new);a("hidden",d.hidden);a("obscured",d.obscured);a("collapsed",d.collapsed);a("collapsed-child",d.collapsedAncestorId);a("moderator",d.is_posted_by_moderator);a("preview",d.is_preview);return _.uniq(b).join(" ")},attributes:function(){return{id:this.model.id}},delegateEvents:function(){},hasProfilePicture:function(){return this.model.user().get("profile_image")&&Chorus.Environment.currentBreakpoint().index>=Chorus.Comments.settings.avatarBreakpointIndex&&Chorus.Comments.settings.showAvatars},render:function(){var a=this.model.toJSON();this.$el.html(this.template({view:this,context:Chorus.Comments.context,settings:Chorus.Comments.settings,comment:a}));if(this.model.isEditable()){this.updateEditCountdown()}this.makeImagesHideable();if(this.replyForm){this.$el.append(this.replyForm.el);this.replyForm.delegateEvents()}this.trigger("render",this);return this},makeImagesHideable:function(){var a=this.$(".cbody img");a.wrap('<span href="#" class="image_toggle"></span>').parent().toggleClass("hidden",!Chorus.Comments.settings.showImages).append('<span class="message"></span>');if(Modernizr.localstorage){a.each(function(){var b=jQuery(this);if(localStorage.getItem(b.attr("src"))){b.parent().addClass("hidden")}})}},toggleImage:function(b){jQuery(b.currentTarget).parent().toggleClass("hidden");if(Modernizr.localstorage){var c=jQuery(b.currentTarget).parent();var a=c.find("img").attr("src");c.hasClass("hidden")?localStorage.setItem(a,"hidden"):localStorage.removeItem(a)}return false},renderReplyCounts:function(){var c=this.model.descendants();var b=c.length;if(b>0){var a=_.filter(c,function(e){return e.get("is_new")}).length;var d=(b===1)?"1 reply":b+" replies";if(a>0){d+=", "+a+" new"}this.$(".reply_count").text(d)}},regenerateWrapperClass:function(){this.$el.attr("class",this.className())},updateEditCountdown:function(){var a=Chorus.Comments.settings.editTimeWindow-this.model.secondsSinceCreate();if(a>0){this.$(".countdown_timer").text(Math.round(a));this.$(".countdown_timer_bar").width(100*(a/Chorus.Comments.settings.editTimeWindow)+"%");setTimeout(_.bind(this.updateEditCountdown,this),1000)}else{this.$(".edit_link").remove();this.$(".countdown_timer").text("");this.$(".countdown_timer_bar").remove()}},reply:function(){if(!Chorus.Comments.context.user_id){Chorus.Auth.modal.open("login")}else{if(!Chorus.Comments.context.able_to_comment){var a=jQuery("#comment_tease, #comments .m-user-msg__account-action, #comments .m-user-msg__membership_required").offset();if(a){jQuery("html, body").animate({scrollTop:a.top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})}}else{if(!this.replyForm){this.replyForm=new Chorus.Comments.Views.ReplyForm({model:this.model,collection:this.model.collection});this.replyForm.renderTo(this.el);this.listenTo(this.replyForm,"cancel",function(){this.replyForm=null})}}}return false},edit:function(){this.$el.addClass("ui-state-editing");var a=new Chorus.Comments.Views.EditForm({model:this.model});a.render().$el.prependTo(this.el);a.once("cancel",function(){this.$el.removeClass("ui-state-editing")},this);return false},toggleHidden:function(){var b=this.model.get("hidden");var a=_.any(this.model.ancestors(),function(d){return d.get("hidden")});if(a){alert("You can't "+(b?"unhide":"hide")+" this comment, because its parents are already hidden.")}else{if(b){this.model.unhide()}else{this.model.hide()}}return false},destroy:function(){var a=confirm("You're about to delete this comment and all its replies. Are you sure?");if(a===true){this.model.destroy()}return false},toggleActions:function(){this.$el.toggleClass("ui-state-tools-active");return false},toggleRecommended:function(){if(this.model.get("is_recommended_by_user")){this.model.unrecommend()}else{this.model.recommend()}return false},toggleFlagged:function(){if(this.model.get("is_flagged_by_user")){this.model.unflag()}else{new Chorus.Comments.Views.FlagDialog({model:this.model}).render()}return false},inspectFlags:function(){new Chorus.Comments.Views.InspectFlagsDialog({model:this.model}).render();return false},toggleCollapsed:function(){if(this.model.get("collapsed")){this.uncollapse()}else{this.collapse();this.renderReplyCounts()}return false},collapse:function(){this.model.set("collapsed",true)},uncollapse:function(){this.model.set("collapsed",false)},activate:function(){this.$el.addClass("active");jQuery("html, body").stop(true).animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.scrollAnimationDuration})},activateParent:function(){var a=this.model.parent();if(a){Chorus.Comments.trigger("activateComment",a.id)}return false},deactivate:function(){this.$el.removeClass("active")},markCollapsedDescendantsRead:function(){if(this.model.get("collapsed")){_.each(this.model.descendants(),function(a){a.set("is_new",false)});this.renderReplyCounts()}}});Chorus.Comments.Views.CommentList=Backbone.View.extend({id:"comments_list",className:"comment_master_list",childSelector:".citem",childView:Chorus.Comments.Views.Comment,shortcuts:{"Shift+a":"markAllRead","Shift+c":"activatePrev",c:"activateNext",j:"activateNext",k:"activatePrev",x:"markRead",z:"markReadAndActivateNext",r:"replyToCurrent"},initialize:function(){this.childViews={};this.listenTo(this.collection,"loadSuccess",this.renderAll);this.listenTo(this.collection,"add",this.renderOne);this.listenTo(this.collection,"remove",this.removeOne);this.listenTo(this.collection,"loadSuccess add",this.renderEmbeds);this.listenTo(Chorus.Comments,"activateComment",this.activateId);this.listenTo(this,"renderAll",this.activateHash);_.each(this.shortcuts,function(b,a){shortcut.add(a,_.bind(this[b],this),{disable_in_input:true})},this)},render:function(){return this},delegateEvents:function(){_.each(this.childView.prototype.events,function(d,f){var e=f.match(/^(\S+)\s+(.+)$/);var c=e[1],a=e[2];var g=this.childViews;var b=this.childSelector;this.$el.on(c+".delegateEvents",b+" "+a,function(i){var j=jQuery(this).closest(b);var h=g[j.attr("id")];if(h){return h[d].call(h,i)}})},this);return Backbone.View.prototype.delegateEvents.call(this)},removeAll:function(){this.$el.empty();this.trigger("removeAll",this);this.childViews={};return this},removeOne:function(b){var a=this.childViews[b.id];if(a){a.remove()}delete this.childViews[b.id];this.trigger("removeOne",this,a,b);return this},renderAll:function(){var a=Chorus.Comments.settings;return this.renderPage(0,a.renderChunkLength)},renderPage:function(e,b){var c=Chorus.Comments.settings;var a=_.map(this.collection.slice(e,b),function(f){return this.renderOne(f,false).el},this);this.$el.append(a);this.trigger("renderPage",this,e,b);if(b<this.collection.length){e=b;b=Math.min(this.collection.length,e+Chorus.Comments.settings.renderChunkLength);var d=function(){this.renderPage(e,b)};setTimeout(_.bind(d,this),0)}else{this.trigger("renderAll",this)}return this},renderOne:function(f,e){var c=this.childViews[f.id]||new this.childView({model:f});this.childViews[f.id]=c.render();if(e){var b=this.collection.length;var a=this.collection.indexOf(f)+1;var d;while(!d&&a<b){d=this.collection.at(a++);d=d&&this.childViews[d.id]}if(d){d.$el.before(c.el)}else{this.$el.append(c.el)}this.trigger("renderOne",this,c,f)}return c},renderEmbeds:function(){if(window.twttr&&window.twttr.widgets&&_.isFunction(window.twttr.widgets.load)){window.twttr.widgets.load()}},activeModel:function(){return this.activeId?this.collection.get(this.activeId):null},activeView:function(){return this.activeId?this.childViews[this.activeId]:null},activateId:function(c){var b=this.activeView();var a=this.childViews[c];if(b){b.deactivate()}if(a){if(a.$el.hasClass("collapsed-child")){this.activateId(a.model.get("parent_id"))}else{a.activate();this.activeId=c}}return this},activateHash:function(){var a=window.location.hash.match(/^#(\d+)$/);if(a){return this.activateId(a[1])}},activateNeighbor:function(c){var a=this.activeModel();var b;if(a){b=a[c]({is_new:true},true)}else{b=(c==="next")?this.collection.first():this.collection.last();while(b&&!b.get("is_new")){b=b[c]()}}if(b){return this.activateId(b.id)}},activatePrev:function(){if(this.collection.loaded){this.activateNeighbor("prev")}else{this.loadThenRun("activatePrev")}},activateNext:function(){if(this.collection.loaded){this.activateNeighbor("next")}else{this.loadThenRun("activateNext")}},markRead:function(){var b=this.activeModel();var a=this.activeView();if(b){b.set("is_new",false);b.trigger("markRead")}if(a){a.deactivate()}},markAllRead:function(){_.each(this.collection.where({is_new:true}),function(a){a.set("is_new",false)})},markAllUnread:function(){this.collection.each(function(a){a.set("is_new",true)});if(!this.activeId){this.activeId=this.collection.first().id}},markReadAndActivateNext:function(){if(this.collection.loaded){this.markRead();this.activateNext()}else{this.loadThenRun("markReadAndActivateNext")}},replyToCurrent:function(){var a=this.activeView();if(a){a.reply()}},loadThenRun:function(a){jQuery("html, body").animate({scrollTop:this.$el.offset().top-Chorus.Comments.settings.offsetHeight},{duration:Chorus.Comments.settings.animationDuration});if(!Chorus.Comments.settings.startOnScroll){Chorus.Comments.start()}this.listenToOnce(this.collection,"loadSuccess",this[a])}});Chorus.Comments.Views.CommentsClosedNotice=Backbone.View.extend({templateId:"comments-closed-notice-template",render:function(){this.$el.html(this.template());this.trigger("render",this);return this}});Chorus.Comments.Views.EditForm=Backbone.View.extend({className:"cedit cform",templateId:"comment-edit-form-template",events:{"submit form":"submit","click .post_edit_button":"submit","click .cancel_edit_button":"cancel"},render:function(){this.$el.html(this.template({comment:this.model.toJSON()}));this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);this.trigger("render",this);return this},formData:function(){var a=this.$("form").serializeArray();var b={};_.each(a,function(c){b[c.name]=c.value});return b},submit:function(){var a=this.$(".post_edit_button");a.prop("disabled",true).val("Saving...");this.model.once("editSuccess",function(){this.cancel()},this);this.model.once("editError",function(){a.prop("disabled",false).val("Save")},this);this.model.edit(this.formData());return false},cancel:function(){this.remove();this.trigger("cancel");return false}});Chorus.Comments.Views.FlagDialog=Backbone.View.extend({templateId:"comment-flag-dialog-template",events:{"submit form":"submit"},render:function(){var a=this.template({comment:this.model.toJSON()});Chorus.Comments.openModal(a);this.setElement("#comment_flag_modal");this.trigger("render",this);return this},submit:function(){this.model.flag(this.$("form").serialize());Chorus.Comments.closeModal();return false}});Chorus.Comments.Views.Footer=Backbone.View.extend({templateId:"comments-footer-template",render:function(){this.$el.html(this.template());this.trigger("render",this);return this}});Chorus.Comments.Views.FormattingGuide=Backbone.View.extend({id:"comment_formatting_guide",templateId:"comment-formatting-guide-template",render:function(){this.$el.html(this.template()).hide();this.trigger("render",this);return this}});Chorus.Comments.Views.Header=Backbone.View.extend({className:"comments-header ui-state-unloaded",templateId:"comments-header-template",events:{"click .show_comments_link":"loadComments","click .tips_link":"toggleTips","click .auto_update_alert_toggle":"toggleAutoUpdateAlert","click .touch_tools_toggle":"toggleTouchTools"},initialize:function(){this.listenTo(Chorus.Comments,"start",this.showLoadingIndicator);this.listenTo(this.collection,"loadSuccess",this.hideLoadingIndicator);this.listenTo(this.collection,"loadError",this.showLoadError);this.listenTo(this.collection,"loadSuccess",this.render);this.listenTo(this.collection,"updateSuccess",this.updateCount)},render:function(){this.$el.html(this.template({context:Chorus.Comments.context,settings:Chorus.Comments.settings}));this.trigger("render",this);return this},loadComments:function(){Chorus.Comments.start();return false},toggleTips:function(){this.$el.toggleClass("ui-state-tips-active");return false},showLoadError:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-loading").addClass("ui-state-load-error")},showLoadingIndicator:function(){this.$el.removeClass("ui-state-loaded").removeClass("ui-state-unloaded").removeClass("ui-state-load-error").addClass("ui-state-loading")},hideLoadingIndicator:function(){this.$el.removeClass("ui-state-unloaded").removeClass("ui-state-loading").removeClass("ui-state-load-error").addClass("ui-state-loaded")},updateCount:function(){this.$(".count").text(this.collection.length)},toggleAutoUpdateAlert:function(){var a=!Chorus.Comments.settings.showAutoUpdateAlert;Chorus.Comments.settings.showAutoUpdateAlert=a;this.$(".auto_update_alert_toggle").text(a?"Hide it!":"Show it!");return false},toggleTouchTools:function(){if(Chorus.Comments.view.touchTools){Chorus.Comments.view.touchTools.toggle()}return false}});Chorus.Comments.Views.InspectFlagsDialog=Backbone.View.extend({templateId:"comment-inspect-flags-dialog-template",render:function(){if(!this.model.flaggingsLoaded){this.model.once("loadFlaggingsSuccess",this.render,this);this.model.loadFlaggings();return this}var a=this.template({comment:this.model.toJSON(),flaggings:_.invoke(this.model.flaggings(),"toJSON")});Chorus.Comments.openModal(a);this.setElement("#inspect_flags_modal");this.trigger("render",this);return this}});Chorus.Comments.Views.MainForm=Chorus.Comments.Views.BaseForm.extend({id:"main_comment_form",className:"cform cform-main",templateId:"comment-main-form-template",submitText:"Post",events:function(){var a=_.clone(Chorus.Comments.Views.BaseForm.prototype.events);a["click #formatting_guide_links a"]="toggleFormattingGuide";return a},render:function(){this.$el.html(this.template({context:Chorus.Comments.context}));this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);var a=new Chorus.Comments.Views.FormattingGuide();a.render().$el.appendTo(this.el);this.trigger("render",this);return this},cancel:function(){if(this.previewView){this.previewView.remove();this.previewView=null}this.$(".preview-controls").hide();this.$(".post_comment_button").prop("disabled",false).val("Post");this.$(".preview_comment_button").prop("disabled",false).val("Preview");this.$("form").get(0).reset();this.trigger("cancel");return false},toggleFormattingGuide:function(a){jQuery(a.target).hide().siblings().show();jQuery("#comment_formatting_guide").slideToggle();return false}});Chorus.Comments.Views.Main=Backbone.View.extend({events:{"click .spoiler":"toggleSpoiler"},initialize:function(){var a=Chorus.Comments.Views;this.header=new a.Header({collection:this.collection});this.commentList=new a.CommentList({collection:this.collection});this.footer=new a.Footer();if(Chorus.Comments.settings.startOnScroll){this.pollScrollPosition()}this.listenTo(this.collection,"loadSuccess",this.renderWithContext);this.listenTo(this.collection,"loadError",this.renderError)},render:function(){this.$el.append(this.header.render().el,this.commentList.render().el);this.trigger("render",this);return this},remove:function(){this.header.remove();this.commentList.remove();this.footer.remove();if(this.mainForm){this.mainForm.remove()}if(this.touchTools){this.touchTools.remove()}if(this.autoUpdateAlert){this.autoUpdateAlert.remove()}this.$el.remove();return this},renderWithContext:function(){var e=Chorus.Comments.Views;var c=Chorus.Comments.context;var d=Chorus.Comments.settings;var a=false;if(c.comments_closed){this.mainForm=new e.CommentsClosedNotice()}else{if(c.able_to_comment){this.mainForm=new e.MainForm({collection:this.collection})}else{this.mainForm=new Backbone.View();a=true}}var b=new e.AccountActions();this.$el.append(b.render().el,this.mainForm.render().el,this.footer.render().el);if(a&&!_.isUndefined(Chorus.Auth)){Chorus.Auth.init()}if(c.able_to_comment&&!c.comments_closed&&Chorus.Environment.touch()){this.touchTools=new e.TouchTools({collection:this.collection});this.touchTools.render().$el.appendTo(this.el)}if(d.autoUpdateEnabled&&d.showAutoUpdateAlert){this.autoUpdateAlert=new e.AutoUpdateAlert({collection:this.collection});this.autoUpdateAlert.render().$el.appendTo(this.el)}this.trigger("render",this);return this},renderError:function(){this.$el.append('<h2 class="comments-load-error-msg">There was an error loading the comments. Please try again later</h2>')},pollScrollPosition:function(){var c=this.$el;var d=jQuery(window);var a=Chorus.Comments.settings.scrollBuffer;var b=function(){if(c.offset().top-d.scrollTop()-d.height()-a<0){Chorus.Comments.start()}};b=_.throttle(b,200);b();d.on("scroll",b);Chorus.Comments.once("start",function(){d.off("scroll",b)})},toggleSpoiler:function(a){jQuery(a.target).toggleClass("reveal_spoiler");return false}});Chorus.Comments.Views.ReplyForm=Chorus.Comments.Views.BaseForm.extend({className:"cform",templateId:"comment-reply-form-template",submitText:"Reply",renderTo:function(a){this.$el.html(this.template({context:Chorus.Comments.context,comment:this.model.toJSON()}));this.$("textarea").markItUp(Chorus.Comments.settings.markItUp);this.$el.appendTo(a);this.$("[autofocus]:first").focus();this.trigger("render",this);return this},cancel:function(){this.remove();this.trigger("cancel");return false}});Chorus.Comments.Views.TouchTools=Backbone.View.extend({id:"comment_touch_tools",templateId:"comment-touch-tools-template",events:{"click .close":"toggle","click .refresh":"refresh","click .next":"activateNext","click .mark":"markAllRead"},initialize:function(){this.listenTo(this.collection,"updateSuccess updateError",this.stopLoading)},render:function(){this.$el.html(this.template());this.trigger("render",this);return this},toggle:function(){this.$el.toggle();return false},refresh:function(){this.$el.addClass("loading");this.collection.update();return false},stopLoading:function(){this.$el.removeClass("loading")},activateNext:function(){Chorus.Comments.view.commentList.markReadAndActivateNext();return false},markAllRead:function(){Chorus.Comments.view.commentList.markAllRead();return false}});var Chorus=Chorus||{};Chorus.HubAdminMenu=(function(a){return{init:function(){jQuery(function(b){b("#hub-admin-menu").click(function(){b(this).toggleClass("is-open")})})}}})(jQuery);jQuery(function(){Chorus.HubAdminMenu.init()});var Kicksend={mailcheck:{threshold:3,defaultDomains:"yahoo.com google.com hotmail.com gmail.com me.com aol.com mac.com live.com comcast.net googlemail.com msn.com hotmail.co.uk yahoo.co.uk facebook.com verizon.net sbcglobal.net att.net gmx.com mail.com".split(" "),defaultTopLevelDomains:"co.uk com net org info edu gov mil".split(" "),run:function(d){d.domains=d.domains||Kicksend.mailcheck.defaultDomains;d.topLevelDomains=d.topLevelDomains||Kicksend.mailcheck.defaultTopLevelDomains;d.distanceFunction=d.distanceFunction||Kicksend.sift3Distance;var c=Kicksend.mailcheck.suggest(encodeURI(d.email),d.domains,d.topLevelDomains,d.distanceFunction);c?d.suggested&&d.suggested(c):d.empty&&d.empty()},suggest:function(f,e,h,g){f=f.toLowerCase();f=this.splitEmail(f);if(e=this.findClosestDomain(f.domain,e,g)){if(e!=f.domain){return{address:f.address,domain:e,full:f.address+"@"+e}}}else{if(h=this.findClosestDomain(f.topLevelDomain,h),f.domain&&h&&h!=f.topLevelDomain){return e=f.domain,e=e.substring(0,e.lastIndexOf(f.topLevelDomain))+h,{address:f.address,domain:e,full:f.address+"@"+e}}}return !1},findClosestDomain:function(i,h,o){var n,m=99,j=null;if(!i||!h){return !1}o||(o=this.sift3Distance);for(var l=0;l<h.length;l++){if(i===h[l]){return i}n=o(i,h[l]);n<m&&(m=n,j=h[l])}return m<=this.threshold&&null!==j?j:!1},sift3Distance:function(i,h){if(null==i||0===i.length){return null==h||0===h.length?0:h.length}if(null==h||0===h.length){return i.length}for(var o=0,n=0,m=0,j=0;o+n<i.length&&o+m<h.length;){if(i.charAt(o+n)==h.charAt(o+m)){j++}else{for(var l=m=n=0;5>l;l++){if(o+l<i.length&&i.charAt(o+l)==h.charAt(o)){n=l;break}if(o+l<h.length&&i.charAt(o)==h.charAt(o+l)){m=l;break}}}o++}return(i.length+h.length)/2-j},splitEmail:function(g){g=g.split("@");if(2>g.length){return !1}for(var f=0;f<g.length;f++){if(""===g[f]){return !1}}var j=g.pop(),i=j.split("."),h="";if(0==i.length){return !1}if(1==i.length){h=i[0]}else{for(f=1;f<i.length;f++){h+=i[f]+"."}2<=i.length&&(h=h.substring(0,h.length-1))}return{topLevelDomain:h,domain:j,address:g.join("@")}}}};window.jQuery&&function(b){b.fn.mailcheck=function(f){var i=this;if(f.suggested){var h=f.suggested;f.suggested=function(c){h(i,c)}}if(f.empty){var g=f.empty;f.empty=function(){g.call(null,i)}}f.email=this.val();Kicksend.mailcheck.run(f)}}(jQuery);var Chorus=Chorus||{};Chorus.Auth=(function(a){return{config:function(b){this.element={wrapper:a(".m-auth-modal__wrapper"),modal:a(".m-auth-modal"),close:a(".m-auth-modal__close"),body:a(".m-auth-modal__body"),form:a(".m-auth-modal__form"),loginTable:a(".m-auth-modal__login-table"),loadingMsg:a("#chorus-auth-loading-message")};this.authTriggers={data:a("[data-chorus-auth]"),goTo:a("[data-chorus-auth-goto]"),auto:a("[data-chorus-auth-auto]"),facebook:a('[data-chorus-auth-login="facebook"]'),openId:a('[data-chorus-auth-login="openid"]'),twitter:a('[data-chorus-auth-login="twitter"]'),yahoo:a('[data-chorus-auth-login="yahoo"]'),password:a("#chorus-auth-password")};this.globals={serializedForm:""};this.openModalClass="-has-open-auth-modal";this.networkUrl=this.element.modal.data("chorus-auth-network-url");if(Chorus.Auth.helpers.noCorsSupport()){this.networkUrl=Chorus.Auth.helpers.httpNetworkUrl()}b()},defaultAjaxOptions:{xhrFields:{withCredentials:true}},init:function(){this.config(function(){if(!Chorus.Auth.networkUrl){return}if(window.addEventListener){window.addEventListener("message",function(b){var d=Chorus.Auth.helpers.httpNetworkUrl();if(b.origin===d){var c=JSON.parse(b.data);if(c.is_from_chorus_auth){Chorus.Auth.actions.callbacks.chorusAuth(c)}}},false)}Chorus.Auth.events.bind();Chorus.Auth.helpers.placeholderPolyfill();Chorus.Auth.helpers.checkForAutoLoad()})},events:{bind:function(){if(!Util.UserAgentProfiler.isMobile()){Chorus.Auth.authTriggers.data.on("click",Chorus.Auth.modal.open)}Chorus.Auth.authTriggers.goTo.on("click",Chorus.Auth.modal.goTo);Chorus.Auth.element.wrapper.on("click",Chorus.Auth.modal.close);Chorus.Auth.element.modal.find(Chorus.Auth.element.close).on("click",Chorus.Auth.modal.close);Chorus.Auth.authTriggers.password.on("submit",Chorus.Auth.actions.login.password);var e=Chorus.Auth.modal.goTo("forgot",true);e.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);Chorus.Auth.authTriggers.facebook.on("click",Chorus.Auth.actions.login.facebook);Chorus.Auth.authTriggers.twitter.on("click",Chorus.Auth.actions.login.twitter);Chorus.Auth.authTriggers.yahoo.on("click",Chorus.Auth.actions.login.yahoo);Chorus.Auth.authTriggers.openId.on("click",Chorus.Auth.actions.showOpenIdForm);Chorus.Auth.element.form.filter(".openid").on("submit",Chorus.Auth.actions.login.openId);var g=["join","register-join"];for(var c=0;c<g.length;c++){var d=Chorus.Auth.modal.goTo(g[c],true);d.find('input[type="checkbox"]').on("change",Chorus.Auth.actions.validate.checkboxEnablesForm);d.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}Chorus.Auth.modal.goTo("umbel-permissions",true).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var f=Chorus.Auth.modal.goTo("third-party-register",true);f.find('[name="user[username]"]').on("focus",Chorus.Auth.actions.validate.validationEnablesForm);f.find('[name="user[username]"]').on("focus blur",Chorus.Auth.actions.validate.username);f.find("form").on("submit",Chorus.Auth.actions.form.startSubmission);Chorus.Auth.modal.goTo("captcha",true).find("form").on("submit",Chorus.Auth.actions.form.startSubmission);var b=Chorus.Auth.modal.goTo("register",true);b.find('[name="user[username]"]').on("blur",Chorus.Auth.actions.validate.username);b.find('[name="user[password]"]').on("blur",Chorus.Auth.actions.validate.password);b.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.email);b.find('[name="user[email]"]').on("blur",Chorus.Auth.actions.validate.suggestEmail);b.find("form").on("submit",Chorus.Auth.actions.form.startSubmission)}},actions:{validate:{email:function(c){var b=Chorus.Auth.actions.validate.getInputContext(c);b.errorId="email";if(!_.isEmpty(b.value)){Chorus.Auth.actions.validate.testAgainstJSON("email_valid",{email:b.value},b)}else{b.status.removeClass("error success");Chorus.Auth.actions.validate.errors.clear(b)}},suggestEmail:function(c){var b=Chorus.Auth.actions.validate.getInputContext(c);b.errorId="suggest-email";a(b.input).mailcheck({suggested:function(e,d){Chorus.Auth.actions.validate.errors.show(b,"Did you mean "+d.full+"?")},empty:function(d){Chorus.Auth.actions.validate.errors.clear(b)}})},username:function(b){var c=Chorus.Auth.actions.validate.getInputContext(b);c.errorId="username";if(!_.isEmpty(c.value)){Chorus.Auth.actions.validate.testAgainstJSON("username_available",{username:c.value},c)}else{c.status.removeClass("error success")}},password:function(d){var c=Chorus.Auth.actions.validate.getInputContext(d);c.errorId="password";if(!_.isEmpty(c.value)){var b=(c.value.length>=6&&c.value.match(/\d/)&&c.value.match(/\d/).length&&c.value.match(/[a-z]/i)&&c.value.match(/[a-z]/i).length)?true:false;Chorus.Auth.actions.validate.addCheckOrX(b,c)}else{c.status.removeClass("error success")}},checkboxEnablesForm:function(d){var c=Chorus.Auth.actions.validate.getInputContext(d);c.errorId="checkbox";var b=c.modalObj.find('[type="submit"]');if(c.input.is(":checked")){b.removeAttr("disabled")}else{b.attr("disabled",true)}},getInputContext:function(f){var c=a(f.target);var d=c.parents(Chorus.Auth.element.body.selector);var b={input:c,status:c.parent(),value:c.val(),modal:d.data("chorus-auth-modal"),modalObj:d,errorMsg:c.data("error-msg"),errorEl:c.parent().find("h6")};return b},testAgainstJSON:function(b,d,c){a.getJSON(Chorus.Auth.networkUrl+"/chorus_auth/"+b+".json?callback=?",d).success(function(e){Chorus.Auth.actions.validate.addCheckOrX(e,c)})},addCheckOrX:function(c,b){if(c.available||(_.isBoolean(c)&&c)){b.status.addClass("success");b.status.removeClass("error");Chorus.Auth.actions.validate.errors.clear(b)}else{b.status.addClass("error");b.status.removeClass("success");if(_.isUndefined(c.message)){Chorus.Auth.actions.validate.errors.show(b)}else{Chorus.Auth.actions.validate.errors.show(b,c.message)}}},isFormValid:function(c){var b=a(c.target);var f=b.find("fieldset").filter("[data-chorus-auth-validate]").length;var d=b.find("fieldset").filter("[data-chorus-auth-validate].success").length;return(f===d)},errors:{show:function(c,d){var b=(_.isUndefined(d))?c.errorMsg:d;if(!c.status.find("#"+c.errorId).length){a("<h6/>").appendTo(c.status).attr("id",c.errorId).text(b);if(!c.status.hasClass("error")){c.status.addClass("error");c.status.removeClass("success")}}},clear:function(b){b.status.find("#"+b.errorId).remove()}}},form:{startSubmission:function(d){var b=a(d.target).parents(Chorus.Auth.element.body.selector);switch(b.data("chorus-auth-modal")){case"forgot":Chorus.Auth.modal.spinner("Sending...");var c=a(d.target).find("[name='email']").val();a.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/request_password_reset.json",data:{email:c},dataType:"json",success:function(g){var e=Chorus.Auth.modal.goTo("forgot-result",true);e.find("p.error").text("");e.find("p.success").text(g.message);Chorus.Auth.modal.goTo("forgot-result")},error:function(j,g,i){var h=JSON.parse(j.responseText);var e=Chorus.Auth.modal.goTo("forgot-result",true);e.find("p.success").text("");e.find("p.error").text(data.message);Chorus.Auth.modal.goTo("forgot-result")}},Chorus.Auth.defaultAjaxOptions));break;case"join":Chorus.Auth.actions.form.submitJoin();break;case"register-join":if(Chorus.Auth.isCaptchaRequired){Chorus.Auth.modal.goTo("captcha")}else{Chorus.Auth.actions.form.completeSubmission()}break;case"umbel-permissions":Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.modal.goTo("third-party-register");break;case"third-party-register":if(Chorus.Auth.actions.validate.isFormValid(d)){Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.isCaptchaRequired=false;if(Chorus.Auth.modal.goTo("register-join",true).length){Chorus.Auth.modal.goTo("register-join")}else{Chorus.Auth.actions.form.completeSubmission()}}break;case"captcha":Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.actions.form.completeSubmission(Chorus.Auth.actions.captcha.error);break;case"register":if(Chorus.Auth.actions.validate.isFormValid(d)){Chorus.Auth.provider="password";Chorus.Auth.actions.form.serialize(d.target);Chorus.Auth.actions.captcha.init("chorus-auth-register-recaptcha");var f=a(d.target).find("[name='user[username]']").val();Chorus.Auth.modal.goTo("captcha",true).find("span.username").text(f);Chorus.Auth.isCaptchaRequired=true;if(Chorus.Auth.modal.goTo("register-join",true).length){Chorus.Auth.modal.goTo("register-join")}else{Chorus.Auth.modal.goTo("captcha")}}break}d.preventDefault()},completeSubmission:function(b){a.ajax(_.extend({type:"post",url:Chorus.Auth.networkUrl+"/chorus_auth/register.json",data:Chorus.Auth.globals.serializedForm,dataType:"json",success:function(c){Chorus.Auth.actions.login.completeLogin("Register")},error:function(f,c,e){var d=JSON.parse(f.responseText);b(d.message)}},Chorus.Auth.defaultAjaxOptions));Chorus.Auth.modal.spinner("Registering");return false},submitJoin:function(){var b=Chorus.Auth.networkUrl+"/chorus_auth/join_community.json";if(!!Chorus.Context.community_id){b=b+"?community_id="+Chorus.Context.community_id}a.ajax(_.extend({type:"post",url:b,dataType:"json",success:function(c){window.location.reload()},error:function(f,c,e){var d=JSON.parse(f.responseText);console.log(d.message)}},Chorus.Auth.defaultAjaxOptions));Chorus.Auth.modal.spinner("Registering");return false},serialize:function(b){if(!_.isEmpty(Chorus.Auth.globals.serializedForm)){Chorus.Auth.globals.serializedForm+="&"}Chorus.Auth.globals.serializedForm+=a(b).serialize()}},captcha:{init:function(b){a(".m-auth-modal__captcha-container").html("");a.ajax(_.extend({dataType:"html",url:Chorus.Auth.networkUrl+"/chorus_auth/recaptcha",success:function(c){a("#"+b).html(c);a.getScript("http://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){Recaptcha.destroy();Recaptcha.create("6LcgS98SAAAAAJLeEKGYuZxRROAovJl-ltyOgAC4",b,{theme:"custom"});var d=setInterval(function(){if(a(".m-auth-modal__recaptcha #recaptcha_image img").length){a(".m-auth-modal__recaptcha #recaptcha_image").removeAttr("style").find("img").removeAttr("width height");clearInterval(d)}},500)})}},Chorus.Auth.defaultAjaxOptions))},error:function(b){Recaptcha.reload();Chorus.Auth.modal.goTo("captcha",true).find("p.error").text(b);Chorus.Auth.modal.goTo("captcha")}},callbacks:{thirdParty:function(f,d,b){var e=Chorus.Auth.modal.goTo("third-party-register",true);if(!_.isUndefined(d)){var c=e.find('[name="user[username]"]');c.val(d);c.focus()}if(!_.isUndefined(b)){e.find(".m-auth-modal__avatar").attr("src",b)}},chorusAuth:function(c){if(c.logged_in){Chorus.Auth.actions.login.completeLogin("Login")}else{if(!_.isUndefined(c.error)){var b=Chorus.Auth.modal.goTo("register",true);b.find("p.error").text(c.error);Chorus.Auth.modal.goTo("register")}else{if(typeof ga==="function"){ga("send","event","SimpleAuth","Start Registration",c.provider)}else{if(typeof _gaq==="object"){_gaq.push(["_trackEvent","SimpleAuth","Start Registration",c.provider])}}Chorus.Auth.actions.callbacks.thirdParty(c.provider,c.username,c.profile_image_url);if(c.provider==="facebook"){Chorus.Auth.modal.goTo("umbel-permissions")}else{Chorus.Auth.modal.goTo("third-party-register")}}}}},login:{yahoo:function(b){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_yahoo_auth");Chorus.Auth.provider="yahoo";b.preventDefault()},openId:function(c){var b=a(c.target).find("[name='openid']").val();Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_openid_auth?openid_url="+b);Chorus.Auth.provider="open_id";c.preventDefault()},twitter:function(c){var b=Chorus.Auth.networkUrl+"/chorus_auth/initiate_twitter_auth";Chorus.Auth.actions.openAuthWindow(b);Chorus.Auth.provider="twitter";c.preventDefault()},facebook:function(b){Chorus.Auth.actions.openAuthWindow(Chorus.Auth.networkUrl+"/chorus_auth/initiate_facebook_auth");Chorus.Auth.provider="facebook";b.preventDefault()},gplus:function(b){Chorus.Auth.provider="google_plus";if(b.code&&b["g-oauth-window"]){Chorus.Auth.modal.spinner("Authenticating");a.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/finalize_google_plus_auth.json?",data:{code:b.code},success:function(c){Chorus.Auth.actions.callbacks.chorusAuth(c)},dataType:"json"},Chorus.Auth.defaultAjaxOptions))}},password:function(c){var b=a(c.target);var d=function(e){Chorus.Auth.provider="password";if(e.logged_in){Chorus.Auth.actions.login.completeLogin("Login")}else{if(e.captcha_required){Chorus.Auth.actions.captcha.init("chorus-auth-login-recaptcha")}b.find("p.error").text(e.message);Chorus.Auth.modal.goTo("login")}};a.ajax(_.extend({type:"POST",url:Chorus.Auth.networkUrl+"/chorus_auth/initiate_password_auth.json",data:b.serialize(),success:d,dataType:"json"},Chorus.Auth.defaultAjaxOptions));Chorus.Auth.modal.spinner("Logging in...");c.preventDefault()},completeLogin:function(b){if(Chorus.Auth.networkUrl.indexOf("sbnation.com")>0){ga("send","event","SimpleAuth",b,Chorus.Auth.provider)}else{_gaq.push(["_trackEvent","SimpleAuth",b,Chorus.Auth.provider])}setTimeout(function(){window.location.reload()},100)}},openAuthWindow:function(c){Chorus.Auth.modal.spinner("Authenticating");var b=window.open(c,"_blank","height=450,width=800,menubar=yes,status=yes,scrollbars=yes,resizable=yes,titlebar=yes,toolbar=no,menubar=yes,location=yes");if(!b){alert("welp, window blocked")}},resetLoginOptions:function(){Chorus.Auth.element.loginTable.each(function(){a(this).find("tr").not(":first").addClass("other")});Chorus.Auth.element.form.filter(".openid").hide()},showOpenIdForm:function(d){var b=a(d.target);var c=b.parents(Chorus.Auth.element.body.selector);c.find(Chorus.Auth.element.form).filter(".openid").toggle();d.preventDefault()}},modal:{open:function(f){var c=a("body");var b=(_.isObject(f))?a(this).data("chorus-auth"):f;if(Chorus.Auth.helpers.noCorsSupport()&&Chorus.Auth.helpers.notOnNetworkDomain()){var g=Chorus.Auth.helpers.httpNetworkUrl();var d=window.location.href.split("?")[0];window.location.href=g+"/login?return_to="+d}else{Chorus.Auth.element.modal.find('[data-chorus-auth-modal="'+b+'"]').show();Chorus.EventDispatcher.publish("modal_open",{content:Chorus.Auth.element.modal})}if(_.isObject(f)){f.preventDefault()}},close:function(b){if(b.target===this){a("body").removeClass(Chorus.Auth.openModalClass);Chorus.Auth.element.wrapper.hide();Chorus.Auth.element.modal.find("[data-chorus-auth-modal]").hide();Chorus.Auth.actions.resetLoginOptions();b.preventDefault()}},goTo:function(d,b){var f=(_.isObject(d))?a(this).data("chorus-auth-goto"):d;var c=Chorus.Auth.element.body.filter('[data-chorus-auth-modal="'+f+'"]');if(_.isUndefined(b)){Chorus.Auth.element.body.filter(":visible").hide();c.show()}else{return c}if(_.isObject(d)){d.preventDefault()}},spinner:function(b){Chorus.Auth.element.loadingMsg.text(b);Chorus.Auth.modal.goTo("spinner")},moveIntoView:function(){var b=a(window).scrollTop();Chorus.Auth.element.modal.css("top",b)}},helpers:{placeholderPolyfill:function(){var b=document.createElement("input");if("placeholder" in b){return}else{Chorus.Auth.element.modal.find("[placeholder]").focus(function(){var c=a(this);if(c.val()===c.attr("placeholder")){c.val("");c.removeClass("placeholder")}}).blur(function(){var c=a(this);if(c.val()===""||c.val()===c.attr("placeholder")){c.addClass("placeholder");c.val(c.attr("placeholder"))}}).blur()}},checkForAutoLoad:function(){if(Chorus.Auth.authTriggers.auto.length===1){var b=Chorus.Auth.authTriggers.auto.eq(0).data("chorus-auth-auto");Chorus.Auth.modal.open(b)}},httpNetworkUrl:function(){if(Chorus.Auth.networkUrl==null){return null}else{return Chorus.Auth.networkUrl.replace(/^https:\/\//,"http://")}},noCorsSupport:function(){return window.navigator.userAgent.match(/MSIE (6|7|8|9)/)},notOnNetworkDomain:function(){return window.location.href.indexOf(Chorus.Auth.helpers.httpNetworkUrl())!==0}}}})(jQuery);jQuery(function(){Chorus.Auth.init()});